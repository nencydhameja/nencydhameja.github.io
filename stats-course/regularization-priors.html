<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.27">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Regularization as Bayesian Inference – Foundations of Statistical Inference</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-ed96de9b727972fe78a7b5d16c58bf87.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-d279e387f5997211c97d65d1670dc95e.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<meta name="shinylive:serviceworker_dir" content=".">
<script src="site_libs/quarto-contrib/shinylive-0.9.1/shinylive/load-shinylive-sw.js" type="module"></script>
<script src="site_libs/quarto-contrib/shinylive-0.9.1/shinylive/run-python-blocks.js" type="module"></script>
<link href="site_libs/quarto-contrib/shinylive-0.9.1/shinylive/shinylive.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/shinylive-quarto-css/shinylive-quarto.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar docked quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./training-as-mle.html">Statistical Foundations of AI</a></li><li class="breadcrumb-item"><a href="./regularization-priors.html">Regularization as Bayesian Inference</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Foundations of Statistical Inference</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Probability &amp; Uncertainty</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./foundations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Foundations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./variance-sd-se.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variance, SD &amp; Standard Error</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./sampling-distribution.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The Sampling Distribution</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">The Central Limit Theorem</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./simulations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">CLT Simulator</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lln.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">LLN vs CLT</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Inference</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./pvalues-ci.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">p-values &amp; Confidence Intervals</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./test-statistics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Test Statistics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bootstrap.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The Bootstrap</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./blb.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bag of Little Bootstraps</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./power.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Power, Alpha, Beta &amp; MDE</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./monte-carlo.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Monte Carlo Experiments</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./multiple-testing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multiple Testing</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Regression</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./cef.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Regression &amp; the CEF</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./residuals.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Residuals &amp; Controls</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./fwl.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Frisch-Waugh-Lovell</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./omitted-variable-bias.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Omitted Variable Bias</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Algebra of Regression</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./regression-algebra.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The Algebra Behind OLS</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Estimation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./method-of-moments.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Method of Moments</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./maximum-likelihood.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Maximum Likelihood</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./limited-dependent.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Limited Dependent Variables</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./gmm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Generalized Method of Moments</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bayesian-estimation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Estimation</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Standard Errors &amp; Diagnostics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./heteroskedasticity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Heteroskedasticity</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./clustered-se.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Clustered SEs</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./delta-method.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The Delta Method</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./measurement-error.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Measurement Error</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bias-variance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bias-Variance Tradeoff</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./model-selection.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Model Selection</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./degeneracy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">When Inference Breaks Down</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true">
 <span class="menu-text">Causal Thinking</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./correlation-causation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">From Correlation to Causation</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="true">
 <span class="menu-text">Bayesian Thinking</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bayesian-updating.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Updating</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" role="navigation" aria-expanded="true">
 <span class="menu-text">Statistical Foundations of AI</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-10" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./training-as-mle.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Training as Maximum Likelihood</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./regularization-priors.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Regularization as Bayesian Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./prediction-vs-causation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Prediction vs Causation in Foundation Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./experimental-design-ai.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Experimental Design for AI Systems</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./calibration-uncertainty.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Calibration &amp; Uncertainty Quantification</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#the-equivalence-restated" id="toc-the-equivalence-restated" class="nav-link active" data-scroll-target="#the-equivalence-restated">The equivalence, restated</a></li>
  <li><a href="#weight-decay-in-neural-networks" id="toc-weight-decay-in-neural-networks" class="nav-link" data-scroll-target="#weight-decay-in-neural-networks">Weight decay in neural networks</a>
  <ul class="collapse">
  <li><a href="#things-to-try" id="toc-things-to-try" class="nav-link" data-scroll-target="#things-to-try">Things to try</a></li>
  </ul></li>
  <li><a href="#dropout-as-approximate-bayesian-inference" id="toc-dropout-as-approximate-bayesian-inference" class="nav-link" data-scroll-target="#dropout-as-approximate-bayesian-inference">Dropout as approximate Bayesian inference</a></li>
  <li><a href="#early-stopping-as-implicit-regularization" id="toc-early-stopping-as-implicit-regularization" class="nav-link" data-scroll-target="#early-stopping-as-implicit-regularization">Early stopping as implicit regularization</a></li>
  <li><a href="#the-rlhf-penalty-as-a-prior" id="toc-the-rlhf-penalty-as-a-prior" class="nav-link" data-scroll-target="#the-rlhf-penalty-as-a-prior">The RLHF penalty as a prior</a></li>
  <li><a href="#what-the-bayesian-lens-buys-you" id="toc-what-the-bayesian-lens-buys-you" class="nav-link" data-scroll-target="#what-the-bayesian-lens-buys-you">What the Bayesian lens buys you</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./training-as-mle.html">Statistical Foundations of AI</a></li><li class="breadcrumb-item"><a href="./regularization-priors.html">Regularization as Bayesian Inference</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Regularization as Bayesian Inference</h1>
</div>



<div class="quarto-title-meta column-body">

    
  
    
  </div>
  


</header>


<p>The <a href="bayesian-estimation.html">Bayesian Estimation</a> page showed that MAP with a normal prior gives ridge regression, and MAP with a Laplace prior gives lasso. This page extends that idea to the regularization techniques used in modern machine learning. The central claim is precise: <strong>every standard regularizer corresponds to a prior, and every prior corresponds to a regularizer.</strong> This is not an analogy. It is an algebraic equivalence.</p>
<section id="the-equivalence-restated" class="level2">
<h2 class="anchored" data-anchor-id="the-equivalence-restated">The equivalence, restated</h2>
<p>Recall from <a href="bayesian-estimation.html#map-as-regularization">Bayesian Estimation</a> that the MAP objective is:</p>
<p><span class="math display">\[
\hat{\theta}_{\text{MAP}} = \arg\max_\theta \left[\log p(\text{data} \mid \theta) + \log p(\theta)\right]
\]</span></p>
<p>The first term is the log-likelihood (the loss function). The second term is the log-prior (the regularization penalty). Minimizing a regularized loss is maximizing a penalized log-likelihood, which is computing a MAP estimate under some prior.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 54%">
<col style="width: 15%">
<col style="width: 30%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Regularization technique</th>
<th style="text-align: left;">Prior</th>
<th style="text-align: left;">Penalty term</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">L2 (weight decay / ridge)</td>
<td style="text-align: left;"><span class="math inline">\(\theta_j \sim N(0, \tau^2)\)</span></td>
<td style="text-align: left;"><span class="math inline">\(\lambda \|\theta\|_2^2\)</span></td>
</tr>
<tr class="even">
<td style="text-align: left;">L1 (lasso)</td>
<td style="text-align: left;"><span class="math inline">\(\theta_j \sim \text{Laplace}(0, b)\)</span></td>
<td style="text-align: left;"><span class="math inline">\(\lambda \|\theta\|_1\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Elastic net</td>
<td style="text-align: left;">Mixture of normal and Laplace</td>
<td style="text-align: left;"><span class="math inline">\(\lambda_1 \|\theta\|_1 + \lambda_2 \|\theta\|_2^2\)</span></td>
</tr>
<tr class="even">
<td style="text-align: left;">No regularization</td>
<td style="text-align: left;">Flat (uniform) prior</td>
<td style="text-align: left;">None (pure MLE)</td>
</tr>
</tbody>
</table>
<p>The penalty strength <span class="math inline">\(\lambda\)</span> maps to the prior precision: a large <span class="math inline">\(\lambda\)</span> is a tight prior that strongly constrains the parameters toward zero. A small <span class="math inline">\(\lambda\)</span> is a vague prior that lets the data dominate.</p>
</section>
<section id="weight-decay-in-neural-networks" class="level2">
<h2 class="anchored" data-anchor-id="weight-decay-in-neural-networks">Weight decay in neural networks</h2>
<p>The most common regularizer in deep learning is <strong>weight decay</strong>: add <span class="math inline">\(\lambda \|\theta\|_2^2\)</span> to the loss. In the Bayesian interpretation, this is MAP estimation under a Gaussian prior centered at zero.</p>
<p>What does this prior say? “In the absence of data, I believe the weights should be small.” This is a reasonable default — large weights produce extreme predictions and amplify noise. The prior encodes a preference for smooth, conservative functions.</p>
<p>The weight decay coefficient <span class="math inline">\(\lambda\)</span> controls the bias-variance tradeoff from <a href="bias-variance.html">Bias-Variance</a>: too small and the model overfits (high variance); too large and the model underfits (high bias). The Bayesian interpretation makes this tradeoff precise — <span class="math inline">\(\lambda\)</span> is the ratio of the noise variance to the prior variance, <span class="math inline">\(\sigma^2 / \tau^2\)</span>.</p>
<p>The simulation below generates regression data with 8 predictors — the first 5 have true nonzero coefficients, the last 3 are pure noise — and shows how ridge (L2) and lasso (L1) shrink the coefficient estimates as <span class="math inline">\(\lambda\)</span> increases. The key visual: ridge shrinks all coefficients toward zero proportionally, while lasso drives small coefficients to <strong>exactly zero</strong>.</p>
<section id="things-to-try" class="level3">
<h3 class="anchored" data-anchor-id="things-to-try">Things to try</h3>
<ul>
<li><strong>Small λ (≈ 0):</strong> both ridge and lasso estimates are close to OLS — minimal shrinkage. The noise coefficients (6–8) are nonzero due to overfitting.</li>
<li><strong>Increase λ:</strong> ridge shrinks all coefficients proportionally toward zero. Lasso shrinks small coefficients to exactly zero first (variable selection).</li>
<li><strong>Large λ:</strong> all coefficients shrink toward zero. Lasso may zero out even the true signal predictors.</li>
<li><strong>High noise (σ):</strong> OLS estimates are noisier, and the benefits of regularization become more apparent.</li>
</ul>
<pre class="shinylive-r" data-engine="r"><code>#| standalone: true
#| viewerHeight: 680

library(shiny)

ui &lt;- fluidPage(
  tags$head(tags$style(HTML("
    .stats-box {
      background: #f0f4f8; border-radius: 6px; padding: 14px;
      margin-top: 12px; font-size: 14px; line-height: 1.9;
    }
    .stats-box b { color: #2c3e50; }
  "))),

  sidebarLayout(
    sidebarPanel(
      width = 3,

      sliderInput("n", "Sample size (n):",
                  min = 50, max = 500, value = 100, step = 50),

      sliderInput("sigma", "Noise level (σ):",
                  min = 0.5, max = 5, value = 2, step = 0.5),

      sliderInput("log_lambda", "log(λ):",
                  min = -4, max = 4, value = 0, step = 0.2),

      actionButton("go", "New draw", class = "btn-primary", width = "100%"),

      uiOutput("results")
    ),

    mainPanel(
      width = 9,
      fluidRow(
        column(6, plotOutput("ridge_plot", height = "470px")),
        column(6, plotOutput("lasso_plot", height = "470px"))
      )
    )
  )
)

server &lt;- function(input, output, session) {

  # Soft-thresholding operator for lasso
  soft_thresh &lt;- function(x, t) sign(x) * pmax(abs(x) - t, 0)

  # Coordinate descent for lasso
  lasso_fit &lt;- function(X, y, lambda, beta_init = NULL, max_iter = 200) {
    n &lt;- nrow(X)
    p &lt;- ncol(X)
    beta &lt;- if (!is.null(beta_init)) beta_init else rep(0, p)
    # Precompute column norms
    col_norm2 &lt;- colSums(X^2) / n

    for (iter in 1:max_iter) {
      for (j in 1:p) {
        r_j &lt;- y - X[, -j, drop = FALSE] %*% beta[-j]
        beta[j] &lt;- soft_thresh(sum(X[, j] * r_j) / n, lambda) / col_norm2[j]
      }
    }
    beta
  }

  dat &lt;- reactive({
    input$go
    n     &lt;- input$n
    sigma &lt;- input$sigma
    p     &lt;- 8

    # True coefficients: 5 nonzero, 3 zero
    beta_true &lt;- c(3, -2, 1.5, -1, 0.5, 0, 0, 0)

    # Generate data (standardized X)
    X &lt;- matrix(rnorm(n * p), n, p)
    Y &lt;- X %*% beta_true + rnorm(n) * sigma

    # Center Y for penalized regression
    y_c &lt;- Y - mean(Y)

    # Precompute
    XtX &lt;- t(X) %*% X
    Xty &lt;- t(X) %*% y_c

    # OLS
    beta_ols &lt;- as.numeric(solve(XtX) %*% Xty)

    # Compute paths over a grid of lambda values
    lambda_grid &lt;- exp(seq(-4, 4, length.out = 60))

    ridge_path &lt;- matrix(NA, 60, p)
    lasso_path &lt;- matrix(NA, 60, p)

    # Ridge path (closed form)
    for (l in 1:60) {
      ridge_path[l, ] &lt;- as.numeric(
        solve(XtX + lambda_grid[l] * n * diag(p)) %*% Xty
      )
    }

    # Lasso path (coordinate descent with warm starts)
    # Process from largest to smallest lambda
    beta_warm &lt;- rep(0, p)
    ord &lt;- order(lambda_grid, decreasing = TRUE)
    for (l in ord) {
      beta_warm &lt;- lasso_fit(X, y_c, lambda_grid[l], beta_warm, max_iter = 100)
      lasso_path[l, ] &lt;- beta_warm
    }

    list(beta_true = beta_true, beta_ols = beta_ols,
         ridge_path = ridge_path, lasso_path = lasso_path,
         lambda_grid = lambda_grid, p = p, n = n, sigma = sigma)
  })

  output$ridge_plot &lt;- renderPlot({
    d &lt;- dat()
    lam &lt;- exp(input$log_lambda)
    par(mar = c(4.5, 4.5, 3, 1))

    # Color palette for 8 coefficients
    cols &lt;- c("#e74c3c", "#3498db", "#2ecc71", "#f39c12",
              "#9b59b6", "#95a5a6", "#95a5a6", "#95a5a6")

    log_grid &lt;- log(d$lambda_grid)

    ylims &lt;- range(d$ridge_path) * 1.1

    plot(NULL, xlim = range(log_grid), ylim = ylims,
         main = "Ridge (L2) Coefficient Path",
         xlab = expression(log(lambda)),
         ylab = "Coefficient estimate")

    for (j in 1:d$p) {
      lty_j &lt;- if (j &lt;= 5) 1 else 2
      lines(log_grid, d$ridge_path[, j],
            col = cols[j], lwd = 2, lty = lty_j)
    }

    abline(v = log(lam), col = "#2c3e50", lwd = 2, lty = 3)
    abline(h = 0, col = "#7f8c8d", lty = 2)

    # True values as points on right margin
    for (j in 1:d$p) {
      points(max(log_grid) + 0.3, d$beta_true[j],
             pch = 4, col = cols[j], cex = 1.2, lwd = 2)
    }

    legend("topright", bty = "n", cex = 0.7,
           legend = c(paste0("β", 1:5, " (true ≠ 0)"), "β6–β8 (true = 0)"),
           col = c(cols[1:5], "#95a5a6"),
           lwd = 2, lty = c(rep(1, 5), 2))
  })

  output$lasso_plot &lt;- renderPlot({
    d &lt;- dat()
    lam &lt;- exp(input$log_lambda)
    par(mar = c(4.5, 4.5, 3, 1))

    cols &lt;- c("#e74c3c", "#3498db", "#2ecc71", "#f39c12",
              "#9b59b6", "#95a5a6", "#95a5a6", "#95a5a6")

    log_grid &lt;- log(d$lambda_grid)

    ylims &lt;- range(d$lasso_path) * 1.1

    plot(NULL, xlim = range(log_grid), ylim = ylims,
         main = "Lasso (L1) Coefficient Path",
         xlab = expression(log(lambda)),
         ylab = "Coefficient estimate")

    for (j in 1:d$p) {
      lty_j &lt;- if (j &lt;= 5) 1 else 2
      lines(log_grid, d$lasso_path[, j],
            col = cols[j], lwd = 2, lty = lty_j)
    }

    abline(v = log(lam), col = "#2c3e50", lwd = 2, lty = 3)
    abline(h = 0, col = "#7f8c8d", lty = 2)

    for (j in 1:d$p) {
      points(max(log_grid) + 0.3, d$beta_true[j],
             pch = 4, col = cols[j], cex = 1.2, lwd = 2)
    }

    legend("topright", bty = "n", cex = 0.7,
           legend = c(paste0("β", 1:5, " (true ≠ 0)"), "β6–β8 (true = 0)"),
           col = c(cols[1:5], "#95a5a6"),
           lwd = 2, lty = c(rep(1, 5), 2))
  })

  output$results &lt;- renderUI({
    d &lt;- dat()
    lam &lt;- exp(input$log_lambda)

    # Find closest lambda in grid
    idx &lt;- which.min(abs(d$lambda_grid - lam))

    ridge_at &lt;- d$ridge_path[idx, ]
    lasso_at &lt;- d$lasso_path[idx, ]

    n_zero_lasso &lt;- sum(abs(lasso_at) &lt; 1e-6)
    n_zero_ridge &lt;- sum(abs(ridge_at) &lt; 1e-6)

    # MSE of estimates vs true
    mse_ols   &lt;- mean((d$beta_ols - d$beta_true)^2)
    mse_ridge &lt;- mean((ridge_at - d$beta_true)^2)
    mse_lasso &lt;- mean((lasso_at - d$beta_true)^2)

    tags$div(class = "stats-box",
      HTML(paste0(
        "&lt;b&gt;λ = ", round(lam, 3), "&lt;/b&gt;&lt;br&gt;",
        "&lt;hr style='margin:6px 0'&gt;",
        "&lt;b&gt;Coefficients set to zero:&lt;/b&gt;&lt;br&gt;",
        "&amp;nbsp; Ridge: ", n_zero_ridge,
        " | Lasso: ", n_zero_lasso, "&lt;br&gt;",
        "&lt;hr style='margin:6px 0'&gt;",
        "&lt;b&gt;MSE vs true β:&lt;/b&gt;&lt;br&gt;",
        "&amp;nbsp; OLS: ", round(mse_ols, 3), "&lt;br&gt;",
        "&amp;nbsp; Ridge: ", round(mse_ridge, 3), "&lt;br&gt;",
        "&amp;nbsp; Lasso: ", round(mse_lasso, 3)
      ))
    )
  })
}

shinyApp(ui, server)</code></pre>
</section>
</section>
<section id="dropout-as-approximate-bayesian-inference" class="level2">
<h2 class="anchored" data-anchor-id="dropout-as-approximate-bayesian-inference">Dropout as approximate Bayesian inference</h2>
<p><strong>Dropout</strong> randomly sets a fraction of neural network activations to zero during training. At test time, all units are active but scaled by the dropout probability. This was introduced as a heuristic to prevent overfitting.</p>
<p>The Bayesian connection: Gal and Ghahramani (2016) showed that training with dropout is approximately equivalent to variational inference in a Bayesian neural network. Specifically, dropout training minimizes a divergence between an approximate posterior and the true posterior over the weights.</p>
<p>This means:</p>
<ul>
<li>Running the network multiple times with dropout <em>at test time</em> (Monte Carlo dropout) produces samples from an approximate posterior predictive distribution</li>
<li>The spread of these predictions approximates the model’s epistemic uncertainty</li>
<li>This connects dropout to the uncertainty quantification discussed in <a href="calibration-uncertainty.html">Calibration and Uncertainty</a></li>
</ul>
<div class="callout callout-style-simple callout-tip no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>A caveat.</strong> The equivalence between dropout and variational inference is approximate and depends on modeling assumptions that may not hold in practice. The quality of the uncertainty estimates from Monte Carlo dropout is debated in the literature. The connection is theoretically grounded but should not be taken as exact.</p>
</div>
</div>
</div>
</section>
<section id="early-stopping-as-implicit-regularization" class="level2">
<h2 class="anchored" data-anchor-id="early-stopping-as-implicit-regularization">Early stopping as implicit regularization</h2>
<p><strong>Early stopping</strong> — halting training before convergence — also has a Bayesian interpretation. In gradient descent with small learning rate, the trajectory of the parameters from initialization traces out a path from the prior (the initial weights) toward the MLE. Stopping early means the final estimate stays closer to the initialization, which functions as an implicit prior.</p>
<p>For linear models, early stopping with gradient descent is exactly equivalent to L2 regularization: the number of gradient steps plays the role of <span class="math inline">\(1/\lambda\)</span>. Fewer steps = more regularization = tighter prior. For nonlinear models the equivalence is approximate, but the intuition holds.</p>
</section>
<section id="the-rlhf-penalty-as-a-prior" class="level2">
<h2 class="anchored" data-anchor-id="the-rlhf-penalty-as-a-prior">The RLHF penalty as a prior</h2>
<p>Reinforcement Learning from Human Feedback (RLHF) fine-tunes a language model to align with human preferences. The standard objective is:</p>
<p><span class="math display">\[
\max_\theta \; E\left[R(y \mid x)\right] - \beta \, D_{KL}\!\left(\pi_\theta \| \pi_{\text{ref}}\right)
\]</span></p>
<p>where <span class="math inline">\(R\)</span> is a reward model, <span class="math inline">\(\pi_\theta\)</span> is the policy being trained, and <span class="math inline">\(\pi_{\text{ref}}\)</span> is the reference (pre-trained) model. The KL divergence term penalizes deviation from the reference model.</p>
<p>In the Bayesian frame, the reference model acts as a <strong>prior</strong>: it encodes what the model “knew” before seeing human preference data. The KL penalty pulls the fine-tuned model back toward this prior, preventing it from drifting too far in pursuit of reward. The coefficient <span class="math inline">\(\beta\)</span> controls how much the prior matters — analogous to <span class="math inline">\(\lambda\)</span> in weight decay or <span class="math inline">\(1/\tau^2\)</span> in the Bayesian MAP framework.</p>
<p>This is the same tug-of-war described in <a href="bayesian-updating.html">Bayesian Updating</a>: data (human preferences) push the model in one direction; the prior (reference model) pulls it back. With more preference data, the reward signal dominates. With less, the model stays close to its pre-trained behavior.</p>
</section>
<section id="what-the-bayesian-lens-buys-you" class="level2">
<h2 class="anchored" data-anchor-id="what-the-bayesian-lens-buys-you">What the Bayesian lens buys you</h2>
<p>Viewing regularization as Bayesian inference is not just a mathematical curiosity. It provides:</p>
<p><strong>Principled choice of <span class="math inline">\(\lambda\)</span>.</strong> Instead of tuning the regularization strength by cross-validation alone, you can reason about what prior is appropriate for the problem. If you have domain knowledge that parameters should be small, a tight prior (large <span class="math inline">\(\lambda\)</span>) is justified. If you expect sparse effects, a Laplace prior (L1) is appropriate.</p>
<p><strong>A path to uncertainty quantification.</strong> Pure MLE (unregularized training) gives point predictions with no uncertainty. The Bayesian interpretation opens the door to posterior distributions, credible intervals, and predictive uncertainty — tools explored in <a href="calibration-uncertainty.html">Calibration and Uncertainty</a>.</p>
<p><strong>Unified understanding.</strong> Weight decay, dropout, early stopping, and the RLHF penalty all look different mechanically. But they are all doing the same thing: encoding a prior belief that constrains the model. Recognizing this prevents treating them as unrelated “tricks” and enables reasoning about their interactions.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p><span style="white-space:nowrap">© 2026 <a href="https://nencydhameja.com">Nency Dhameja</a> | <a href="../index.html">All Notes</a> | Developed with AI assistance | <a href="mailto:nencydhameja@gmail.com">Feedback?</a></span></p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>