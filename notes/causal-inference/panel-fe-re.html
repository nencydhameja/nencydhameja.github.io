<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.27">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Fixed vs Random Effects – Applied Causal Inference</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-ed96de9b727972fe78a7b5d16c58bf87.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-d279e387f5997211c97d65d1670dc95e.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<meta name="shinylive:serviceworker_dir" content=".">
<script src="site_libs/quarto-contrib/shinylive-0.9.1/shinylive/load-shinylive-sw.js" type="module"></script>
<script src="site_libs/quarto-contrib/shinylive-0.9.1/shinylive/run-python-blocks.js" type="module"></script>
<link href="site_libs/quarto-contrib/shinylive-0.9.1/shinylive/shinylive.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/shinylive-quarto-css/shinylive-quarto.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar docked quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./panel-fe-re.html">Panel Data</a></li><li class="breadcrumb-item"><a href="./panel-fe-re.html">Fixed vs Random Effects</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Applied Causal Inference</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Framework</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./potential-outcomes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Potential Outcomes &amp; ATE</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./identification-estimation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Identification vs Estimation</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Methods</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./selection-observables.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Selection on Observables</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./did.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Difference-in-Differences</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./iv.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Instrumental Variables</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rdd.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Regression Discontinuity</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./synth.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Synthetic Control</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Panel Data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./panel-fe-re.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Fixed vs Random Effects</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Estimation Tools</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./regression-adjustment.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Regression Adjustment</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ipw.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">IPW</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./matching.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Matching</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./entropy-balancing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Entropy Balancing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./doubly-robust.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Doubly Robust</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#panel-data-the-same-units-over-time-or-nested-units" id="toc-panel-data-the-same-units-over-time-or-nested-units" class="nav-link active" data-scroll-target="#panel-data-the-same-units-over-time-or-nested-units">Panel data: the same units over time (or nested units)</a></li>
  <li><a href="#fixed-effects-fe" id="toc-fixed-effects-fe" class="nav-link" data-scroll-target="#fixed-effects-fe">Fixed effects (FE)</a>
  <ul class="collapse">
  <li><a href="#what-fe-eliminates" id="toc-what-fe-eliminates" class="nav-link" data-scroll-target="#what-fe-eliminates">What FE eliminates</a></li>
  <li><a href="#what-fe-cant-do" id="toc-what-fe-cant-do" class="nav-link" data-scroll-target="#what-fe-cant-do">What FE can’t do</a></li>
  </ul></li>
  <li><a href="#random-effects-re" id="toc-random-effects-re" class="nav-link" data-scroll-target="#random-effects-re">Random effects (RE)</a>
  <ul class="collapse">
  <li><a href="#the-critical-assumption" id="toc-the-critical-assumption" class="nav-link" data-scroll-target="#the-critical-assumption">The critical assumption</a></li>
  </ul></li>
  <li><a href="#the-tradeoff" id="toc-the-tradeoff" class="nav-link" data-scroll-target="#the-tradeoff">The tradeoff</a>
  <ul class="collapse">
  <li><a href="#things-to-try" id="toc-things-to-try" class="nav-link" data-scroll-target="#things-to-try">Things to try</a></li>
  </ul></li>
  <li><a href="#the-hausman-test" id="toc-the-hausman-test" class="nav-link" data-scroll-target="#the-hausman-test">The Hausman test</a>
  <ul class="collapse">
  <li><a href="#the-logic" id="toc-the-logic" class="nav-link" data-scroll-target="#the-logic">The logic</a></li>
  <li><a href="#hausman-test-in-practice" id="toc-hausman-test-in-practice" class="nav-link" data-scroll-target="#hausman-test-in-practice">Hausman test in practice</a></li>
  </ul></li>
  <li><a href="#connection-to-other-methods" id="toc-connection-to-other-methods" class="nav-link" data-scroll-target="#connection-to-other-methods">Connection to other methods</a></li>
  <li><a href="#in-stata" id="toc-in-stata" class="nav-link" data-scroll-target="#in-stata">In Stata</a></li>
  <li><a href="#did-you-know" id="toc-did-you-know" class="nav-link" data-scroll-target="#did-you-know">Did you know?</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./panel-fe-re.html">Panel Data</a></li><li class="breadcrumb-item"><a href="./panel-fe-re.html">Fixed vs Random Effects</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Fixed vs Random Effects</h1>
</div>



<div class="quarto-title-meta column-body">

    
  
    
  </div>
  


</header>


<section id="panel-data-the-same-units-over-time-or-nested-units" class="level2">
<h2 class="anchored" data-anchor-id="panel-data-the-same-units-over-time-or-nested-units">Panel data: the same units over time (or nested units)</h2>
<p>Most of the methods in this course use <strong>cross-sectional</strong> data — you see each unit once. But often you observe units <strong>repeatedly</strong>:</p>
<ul>
<li>The same people surveyed each year (panel)</li>
<li>Students nested within schools (clusters)</li>
<li>Census tracts nested within counties (hierarchical)</li>
</ul>
<p>Panel/grouped data has a superpower: you can separate <strong>within-group variation</strong> (what changes over time for the same person) from <strong>between-group variation</strong> (how different people differ from each other). This distinction is the key to fixed vs random effects.</p>
<div class="callout callout-style-simple callout-tip no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Example: dollar stores and obesity.</strong> You have census tracts nested within counties, observed over multiple years. Some tracts get a new dollar store, others don’t. The question: does dollar store presence <em>cause</em> higher obesity? The problem: counties that attract dollar stores may already be different — poorer, more rural, less access to grocery stores. That’s a group-level confounder. Fixed effects can absorb it.</p>
</div>
</div>
</div>
</section>
<section id="fixed-effects-fe" class="level2">
<h2 class="anchored" data-anchor-id="fixed-effects-fe">Fixed effects (FE)</h2>
<p><strong>The idea:</strong> include a separate intercept <span class="math inline">\(\alpha_j\)</span> for each group. This absorbs <em>everything</em> that is constant within the group — observed or unobserved.</p>
<p><span class="math display">\[Y_{it} = \alpha_i + \tau D_{it} + \beta X_{it} + \varepsilon_{it}\]</span></p>
<p>In practice, you <strong>demean</strong> each variable by its group average:</p>
<p><span class="math display">\[\tilde{Y}_{it} = Y_{it} - \bar{Y}_i, \quad \tilde{D}_{it} = D_{it} - \bar{D}_i, \quad \tilde{X}_{it} = X_{it} - \bar{X}_i\]</span></p>
<p>Then regress <span class="math inline">\(\tilde{Y}\)</span> on <span class="math inline">\(\tilde{D}\)</span> and <span class="math inline">\(\tilde{X}\)</span>. The demeaning eliminates <span class="math inline">\(\alpha_i\)</span> entirely — you only use <strong>within-group variation</strong>.</p>
<section id="what-fe-eliminates" class="level3">
<h3 class="anchored" data-anchor-id="what-fe-eliminates">What FE eliminates</h3>
<p>Any variable that is constant within a group gets differenced out:</p>
<ul>
<li>County-level: food culture, geography, baseline poverty level</li>
<li>Person-level (in a panel): ability, motivation, family background</li>
<li>Firm-level: management quality, industry</li>
</ul>
<p><strong>This is the power of FE:</strong> you don’t need to measure or even name the confounders. If they’re constant within groups, they’re gone.</p>
</section>
<section id="what-fe-cant-do" class="level3">
<h3 class="anchored" data-anchor-id="what-fe-cant-do">What FE can’t do</h3>
<ul>
<li><strong>Can’t estimate effects of group-level variables.</strong> If you want to know the effect of being rural vs urban, FE absorbs that — it’s constant within county.</li>
<li><strong>Can’t handle time-varying unobservables.</strong> If something changes within the group <em>and</em> is correlated with treatment, FE doesn’t help.</li>
<li><strong>Uses only within-group variation.</strong> If treatment barely varies within groups, FE has little to work with and estimates are imprecise.</li>
</ul>
</section>
</section>
<section id="random-effects-re" class="level2">
<h2 class="anchored" data-anchor-id="random-effects-re">Random effects (RE)</h2>
<p><strong>The idea:</strong> instead of treating each <span class="math inline">\(\alpha_j\)</span> as a fixed parameter, assume the group effects are <strong>random draws from a population:</strong></p>
<p><span class="math display">\[\alpha_j \sim N(\mu, \tau^2)\]</span></p>
<p>This is the same structure as the <a href="../bayesian-inference/hierarchical.html">hierarchical model</a> on the Bayesian course — RE is its frequentist counterpart. It produces <strong>partial pooling</strong>: small groups are shrunk toward the grand mean.</p>
<section id="the-critical-assumption" class="level3">
<h3 class="anchored" data-anchor-id="the-critical-assumption">The critical assumption</h3>
<p>RE assumes group effects are <strong>uncorrelated with the covariates:</strong></p>
<p><span class="math display">\[E[\alpha_j \mid X_{it}, D_{it}] = \mu \quad \text{(no correlation)}\]</span></p>
<p>If this holds, RE is more <strong>efficient</strong> than FE — it uses both within-group <em>and</em> between-group variation, so estimates are more precise.</p>
<p>If this fails — if groups with higher <span class="math inline">\(\alpha_j\)</span> systematically differ in their <span class="math inline">\(X\)</span> or <span class="math inline">\(D\)</span> values — <strong>RE is biased.</strong> This is the same selection bias problem from the <a href="potential-outcomes.html">potential outcomes</a> page, but at the group level.</p>
</section>
</section>
<section id="the-tradeoff" class="level2">
<h2 class="anchored" data-anchor-id="the-tradeoff">The tradeoff</h2>
<table class="caption-top table">
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th>Fixed effects</th>
<th>Random effects</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Eliminates group-level confounders</strong></td>
<td>Yes</td>
<td>Only if uncorrelated with X</td>
</tr>
<tr class="even">
<td><strong>Uses between-group variation</strong></td>
<td>No (only within)</td>
<td>Yes (within + between)</td>
</tr>
<tr class="odd">
<td><strong>Efficiency</strong></td>
<td>Lower (discards information)</td>
<td>Higher (if assumption holds)</td>
</tr>
<tr class="even">
<td><strong>Can estimate group-level predictors</strong></td>
<td>No</td>
<td>Yes</td>
</tr>
<tr class="odd">
<td><strong>Bias when <span class="math inline">\(\alpha_j\)</span> correlated with X</strong></td>
<td>None</td>
<td><strong>Biased</strong></td>
</tr>
</tbody>
</table>
<p><strong>The rule:</strong> if you’re after a causal effect and you’re worried about group-level confounders, use FE. If you believe the RE assumption (no correlation) or you need group-level predictors, use RE. When in doubt, FE is the safer choice.</p>
<pre class="shinylive-r" data-engine="r"><code>#| standalone: true
#| viewerHeight: 650

library(shiny)

ui &lt;- fluidPage(
  tags$head(tags$style(HTML("
    .stats-box {
      background: #f0f4f8; border-radius: 6px; padding: 14px;
      margin-top: 12px; font-size: 14px; line-height: 1.9;
    }
    .stats-box b { color: #2c3e50; }
    .good { color: #27ae60; font-weight: bold; }
    .bad  { color: #e74c3c; font-weight: bold; }
  "))),

  sidebarLayout(
    sidebarPanel(
      width = 3,

      sliderInput("n_groups", "Number of groups:",
                  min = 10, max = 50, value = 20, step = 5),

      sliderInput("n_per", "Observations per group:",
                  min = 5, max = 50, value = 10, step = 5),

      sliderInput("ate", "True ATE:",
                  min = 0, max = 5, value = 2, step = 0.5),

      sliderInput("corr_alpha", "Correlation (\u03B1 with D):",
                  min = 0, max = 3, value = 0, step = 0.25),

      actionButton("go", "New draw", class = "btn-primary", width = "100%"),

      uiOutput("results")
    ),

    mainPanel(
      width = 9,
      fluidRow(
        column(6, plotOutput("scatter_plot", height = "420px")),
        column(6, plotOutput("compare_plot", height = "420px"))
      )
    )
  )
)

server &lt;- function(input, output, session) {

  dat &lt;- reactive({
    input$go
    J     &lt;- input$n_groups
    n_per &lt;- input$n_per
    ate   &lt;- input$ate
    rho   &lt;- input$corr_alpha

    # Group effects
    alpha &lt;- rnorm(J, mean = 0, sd = 3)

    # Expand to individual level
    group &lt;- rep(1:J, each = n_per)
    alpha_i &lt;- rep(alpha, each = n_per)
    N &lt;- J * n_per

    # Treatment: correlated with group effect (the confounding)
    x &lt;- rnorm(N)
    p_treat &lt;- pnorm(0.5 * x + rho * alpha_i / 3)
    treat &lt;- rbinom(N, 1, p_treat)

    # Outcome
    y &lt;- alpha_i + ate * treat + 1.5 * x + rnorm(N)

    # Naive (pooled OLS, no group effects)
    naive &lt;- coef(lm(y ~ treat + x))["treat"]

    # Fixed effects (demean within group)
    y_dm &lt;- y - ave(y, group)
    d_dm &lt;- treat - ave(treat, group)
    x_dm &lt;- x - ave(x, group)
    fe_est &lt;- coef(lm(y_dm ~ d_dm + x_dm - 1))["d_dm"]

    # Random effects (partial pooling via weighted average)
    # Simple RE: GLS with estimated variance components
    # Use between and within estimators
    y_bar_j &lt;- ave(y, group)
    d_bar_j &lt;- ave(treat, group)
    x_bar_j &lt;- ave(x, group)

    # Within estimator = FE
    # Between estimator
    uj &lt;- tapply(y, group, mean)
    dj &lt;- tapply(treat, group, mean)
    xj &lt;- tapply(x, group, mean)
    if (sd(dj) &gt; 0.01) {
      be_est &lt;- coef(lm(uj ~ dj + xj))["dj"]
    } else {
      be_est &lt;- naive
    }

    # RE is a weighted combo of within and between
    sigma2_e &lt;- var(y_dm - fe_est * d_dm - coef(lm(y_dm ~ d_dm + x_dm - 1))["x_dm"] * x_dm)
    sigma2_a &lt;- max(var(uj - fe_est * dj) - sigma2_e / n_per, 0.01)
    theta &lt;- 1 - sqrt(sigma2_e / (sigma2_e + n_per * sigma2_a))

    y_re &lt;- y - theta * y_bar_j
    d_re &lt;- treat - theta * d_bar_j
    x_re &lt;- x - theta * x_bar_j
    re_est &lt;- coef(lm(y_re ~ d_re + x_re))["d_re"]

    list(y = y, treat = treat, x = x, group = group, alpha_i = alpha_i,
         naive = naive, fe_est = fe_est, re_est = re_est, be_est = be_est,
         ate = ate, rho = rho, J = J, n_per = n_per,
         alpha = alpha)
  })

  output$scatter_plot &lt;- renderPlot({
    d &lt;- dat()
    par(mar = c(4.5, 4.5, 3, 1))

    # Color by group (cycle through colors)
    palette &lt;- rep(c("#3498db", "#e74c3c", "#27ae60", "#f39c12",
                     "#9b59b6", "#1abc9c", "#e67e22", "#2c3e50"),
                   length.out = d$J)
    cols &lt;- paste0(palette[d$group], "50")

    plot(d$x, d$y, pch = 16, cex = 0.4, col = cols,
         xlab = "X (covariate)", ylab = "Y (outcome)",
         main = "Data by Group (colors = groups)")

    # Show a few group means
    show_groups &lt;- 1:min(5, d$J)
    for (j in show_groups) {
      idx &lt;- d$group == j
      points(mean(d$x[idx]), mean(d$y[idx]),
             pch = 17, cex = 1.5, col = palette[j])
    }

    if (d$rho &gt; 0) {
      mtext(expression(alpha[j] * " correlated with D — RE is biased"),
            side = 3, line = 0, cex = 0.8, col = "#e74c3c", font = 2)
    } else {
      mtext(expression(alpha[j] * " independent of D — RE is valid"),
            side = 3, line = 0, cex = 0.8, col = "#27ae60", font = 2)
    }
  })

  output$compare_plot &lt;- renderPlot({
    d &lt;- dat()
    par(mar = c(4.5, 9, 3, 2))

    ests &lt;- c(d$fe_est, d$re_est, d$naive)
    labels &lt;- c("Fixed effects", "Random effects", "Pooled OLS")
    cols &lt;- c("#27ae60", "#3498db", "#e74c3c")

    xlim &lt;- range(c(ests, d$ate))
    pad  &lt;- max(diff(xlim) * 0.4, 0.5)
    xlim &lt;- xlim + c(-pad, pad)

    plot(ests, 1:3, pch = 19, cex = 2, col = cols,
         xlim = xlim, ylim = c(0.5, 3.5),
         yaxt = "n", xlab = "Estimated treatment effect",
         ylab = "", main = "Estimator Comparison")
    axis(2, at = 1:3, labels = labels, las = 1, cex.axis = 0.9)

    abline(v = d$ate, lty = 2, col = "#2c3e50", lwd = 2)
    text(d$ate, 3.45, paste0("True ATE = ", d$ate),
         cex = 0.85, font = 2, col = "#2c3e50")

    segments(d$ate, 1:3, ests, 1:3, col = cols, lwd = 2, lty = 2)
  })

  output$results &lt;- renderUI({
    d &lt;- dat()
    b_naive &lt;- d$naive - d$ate
    b_fe    &lt;- d$fe_est - d$ate
    b_re    &lt;- d$re_est - d$ate

    fe_class &lt;- if (abs(b_fe) &lt; abs(b_naive) * 0.5) "good" else "bad"
    re_class &lt;- if (abs(b_re) &lt; abs(b_naive) * 0.5) "good" else "bad"

    hausman &lt;- abs(d$fe_est - d$re_est)
    h_class &lt;- if (hausman &lt; 0.3) "good" else "bad"
    h_label &lt;- if (hausman &lt; 0.3) "FE \u2248 RE (RE likely OK)" else "FE \u2260 RE (use FE)"

    tags$div(class = "stats-box",
      HTML(paste0(
        "&lt;b&gt;True ATE:&lt;/b&gt; ", d$ate, "&lt;br&gt;",
        "&lt;hr style='margin:6px 0'&gt;",
        "&lt;b&gt;Pooled OLS:&lt;/b&gt; &lt;span class='bad'&gt;", round(d$naive, 3), "&lt;/span&gt;",
        " (bias: ", round(b_naive, 3), ")&lt;br&gt;",
        "&lt;b&gt;Fixed effects:&lt;/b&gt; &lt;span class='", fe_class, "'&gt;",
        round(d$fe_est, 3), "&lt;/span&gt;",
        " (bias: ", round(b_fe, 3), ")&lt;br&gt;",
        "&lt;b&gt;Random effects:&lt;/b&gt; &lt;span class='", re_class, "'&gt;",
        round(d$re_est, 3), "&lt;/span&gt;",
        " (bias: ", round(b_re, 3), ")&lt;br&gt;",
        "&lt;hr style='margin:6px 0'&gt;",
        "&lt;b&gt;|FE \u2212 RE|:&lt;/b&gt; &lt;span class='", h_class, "'&gt;",
        round(hausman, 3), "&lt;/span&gt;&lt;br&gt;",
        "&lt;span class='", h_class, "'&gt;", h_label, "&lt;/span&gt;"
      ))
    )
  })
}

shinyApp(ui, server)</code></pre>
<section id="things-to-try" class="level3">
<h3 class="anchored" data-anchor-id="things-to-try">Things to try</h3>
<ul>
<li><strong>Correlation = 0:</strong> group effects are independent of treatment. All three estimators work, but RE and FE are close to the truth while pooled OLS may show some bias. The |FE − RE| gap is small — Hausman says RE is fine.</li>
<li><strong>Correlation = 1.5:</strong> now groups with higher <span class="math inline">\(\alpha_j\)</span> are more likely to get treated. Pooled OLS is badly biased. <strong>FE still works</strong> (it eliminates <span class="math inline">\(\alpha_j\)</span>). <strong>RE is biased</strong> — it uses between-group variation that’s contaminated by the correlation. The |FE − RE| gap is large — Hausman says use FE.</li>
<li><strong>Correlation = 3:</strong> extreme confounding. RE is nearly as biased as pooled OLS. FE remains unbiased. This is why FE is the default in applied economics.</li>
<li><strong>Small groups (5 obs per group):</strong> FE is noisier because it uses less data. RE is more precise <em>when valid</em> — that’s the efficiency gain. But precision doesn’t help if the estimate is biased.</li>
</ul>
<hr>
</section>
</section>
<section id="the-hausman-test" class="level2">
<h2 class="anchored" data-anchor-id="the-hausman-test">The Hausman test</h2>
<p>You’ve seen it informally in the simulation: when |FE − RE| is large, RE is suspect. The <strong>Hausman test</strong> formalizes this.</p>
<section id="the-logic" class="level3">
<h3 class="anchored" data-anchor-id="the-logic">The logic</h3>
<p>Under the RE assumption (<span class="math inline">\(\alpha_j\)</span> uncorrelated with <span class="math inline">\(X\)</span> and <span class="math inline">\(D\)</span>):</p>
<ul>
<li>FE is <strong>consistent</strong> (unbiased) but <strong>inefficient</strong> (throws away between-group info)</li>
<li>RE is <strong>consistent</strong> <em>and</em> <strong>efficient</strong> (uses all the data)</li>
<li>So FE and RE should give <strong>approximately the same answer</strong></li>
</ul>
<p>If the RE assumption fails:</p>
<ul>
<li>FE is still <strong>consistent</strong> (within-group variation is clean)</li>
<li>RE is <strong>inconsistent</strong> (between-group variation is contaminated)</li>
<li>FE and RE will <strong>diverge</strong></li>
</ul>
<p>The Hausman test exploits this:</p>
<p><span class="math display">\[H = (\hat{\tau}_{FE} - \hat{\tau}_{RE})' \, [\text{Var}(\hat{\tau}_{FE}) - \text{Var}(\hat{\tau}_{RE})]^{-1} \, (\hat{\tau}_{FE} - \hat{\tau}_{RE})\]</span></p>
<p>Under <span class="math inline">\(H_0\)</span> (RE is valid), <span class="math inline">\(H \sim \chi^2_k\)</span> where <span class="math inline">\(k\)</span> is the number of coefficients being compared.</p>
<ul>
<li><strong>Large <span class="math inline">\(H\)</span> (small p-value):</strong> reject <span class="math inline">\(H_0\)</span>. FE and RE disagree → the RE assumption fails → use FE.</li>
<li><strong>Small <span class="math inline">\(H\)</span> (large p-value):</strong> fail to reject. FE and RE agree → RE assumption is plausible → RE is OK (and more efficient).</li>
</ul>
<div class="callout callout-style-simple callout-tip no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Example: returns to education.</strong> You have panel data on workers observed over multiple years. You want the causal effect of an extra year of education on wages.</p>
<ul>
<li><strong>RE assumes:</strong> workers who get more education don’t have systematically higher unobserved ability. Ability is random across education levels.</li>
<li><strong>FE says:</strong> doesn’t matter — I’ll control for each worker’s fixed ability by only using within-person wage changes when they get more education.</li>
</ul>
<p>You run both. FE gives <span class="math inline">\(\hat{\tau} = 0.06\)</span> (6% wage increase per year of education). RE gives <span class="math inline">\(\hat{\tau} = 0.10\)</span> (10%). The gap is large.</p>
<p><strong>Hausman test:</strong> <span class="math inline">\(H = 15.3\)</span>, <span class="math inline">\(p &lt; 0.001\)</span>. Reject <span class="math inline">\(H_0\)</span>. The RE estimate is inflated because high-ability workers get more education <em>and</em> earn more — classic selection bias at the group level. <strong>Use FE.</strong></p>
<p>The FE estimate (6%) is the return to education <em>holding ability constant</em>. The RE estimate (10%) is contaminated by ability differences.</p>
</div>
</div>
</div>
</section>
<section id="hausman-test-in-practice" class="level3">
<h3 class="anchored" data-anchor-id="hausman-test-in-practice">Hausman test in practice</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th>Result</th>
<th>Interpretation</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(p &lt; 0.05\)</span></td>
<td>FE and RE significantly differ</td>
<td>Use FE (RE assumption violated)</td>
</tr>
<tr class="even">
<td><span class="math inline">\(p &gt; 0.05\)</span></td>
<td>No significant difference</td>
<td>RE is OK — more efficient</td>
</tr>
</tbody>
</table>
<p><strong>Caveats:</strong></p>
<ul>
<li>The Hausman test has low power with small samples — it may fail to reject even when RE is biased.</li>
<li>A non-rejection doesn’t <em>prove</em> RE is valid. It means you can’t <em>detect</em> the violation with your data.</li>
<li>In practice, most applied economists default to FE for causal questions and use the Hausman test as a check, not as the primary decision tool.</li>
</ul>
<hr>
</section>
</section>
<section id="connection-to-other-methods" class="level2">
<h2 class="anchored" data-anchor-id="connection-to-other-methods">Connection to other methods</h2>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Method</th>
<th>What it controls for</th>
<th>Assumption</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Fixed effects</strong></td>
<td>All time-invariant group confounders</td>
<td>No time-varying confounders</td>
</tr>
<tr class="even">
<td><strong>Random effects</strong></td>
<td>Group-level variation (partial pooling)</td>
<td>Group effects uncorrelated with X</td>
</tr>
<tr class="odd">
<td><strong><a href="did.html">DID</a></strong></td>
<td>Group FE + time FE</td>
<td>Parallel trends</td>
</tr>
<tr class="even">
<td><strong><a href="../bayesian-inference/hierarchical.html">Hierarchical models</a></strong></td>
<td>Bayesian version of RE</td>
<td>Same as RE, with priors</td>
</tr>
<tr class="odd">
<td><strong><a href="../stats-course/clustered-se.html">Clustered SEs</a></strong></td>
<td>Not a model — fixes standard errors</td>
<td>Doesn’t change point estimates</td>
</tr>
</tbody>
</table>
<p><strong>FE is an identification strategy.</strong> It tells you <em>why</em> your comparison is valid (within-group variation eliminates group-level confounders). RE is a modeling assumption that may or may not hold. When in doubt, FE is the conservative choice for causal inference.</p>
<hr>
</section>
<section id="in-stata" class="level2">
<h2 class="anchored" data-anchor-id="in-stata">In Stata</h2>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>* Declare panel structure</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>xtset unit_id <span class="fu">year</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>* Fixed <span class="kw">effects</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">xtreg</span> outcome treatment x1, <span class="kw">fe</span> <span class="kw">cluster</span>(unit_id)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>* Random <span class="kw">effects</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="kw">xtreg</span> outcome treatment x1, re</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>* Hausman <span class="kw">test</span> (FE vs RE)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="kw">quietly</span> <span class="kw">xtreg</span> outcome treatment x1, <span class="kw">fe</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="kw">estimates</span> <span class="kw">store</span> fe_model</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="kw">quietly</span> <span class="kw">xtreg</span> outcome treatment x1, re</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="kw">estimates</span> <span class="kw">store</span> re_model</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="kw">hausman</span> fe_model re_model</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>* First-difference (alternative to FE)</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> D.outcome D.treatment D.x1, <span class="kw">cluster</span>(unit_id)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>If the Hausman test rejects, use FE — the RE assumption that group effects are uncorrelated with regressors doesn’t hold. For causal inference, FE is almost always the safer choice.</p>
<hr>
</section>
<section id="did-you-know" class="level2">
<h2 class="anchored" data-anchor-id="did-you-know">Did you know?</h2>
<ul>
<li><p>The Hausman test was introduced by <strong>Jerry Hausman (1978)</strong> in one of the most cited papers in econometrics. The general principle extends beyond FE/RE: any time you have a consistent-but-inefficient estimator and an efficient-but-possibly-inconsistent estimator, you can compare them. If they agree, the efficient one is probably fine.</p></li>
<li><p><strong>Mundlak (1978)</strong> showed a clever alternative: add the group means <span class="math inline">\(\bar{X}_j\)</span> as regressors in the RE model. If the coefficient on <span class="math inline">\(\bar{X}_j\)</span> is significant, the RE assumption is violated (same information as the Hausman test, but easier to implement and interpret). This is called the <strong>correlated random effects</strong> approach.</p></li>
<li><p>In the machine learning world, random effects are closely related to <strong>mixed-effects models</strong> (e.g., <code>lme4</code> in R). The terminology differs across fields: what economists call “fixed effects” (unit dummies), statisticians sometimes call “fixed effects” too, but the random effects tradition is much more developed in biostatistics and multilevel modeling (Raudenbush &amp; Bryk, 2002).</p></li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>© 2026 <a href="https://nencydhameja.com">Nency Dhameja</a> | <a href="../index.html">All Notes</a><br><span style="white-space:nowrap">Developed with AI assistance</span></p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>