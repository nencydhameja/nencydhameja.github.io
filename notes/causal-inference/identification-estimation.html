<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.27">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Identification vs Estimation – Applied Causal Inference</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-ed96de9b727972fe78a7b5d16c58bf87.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-d279e387f5997211c97d65d1670dc95e.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<meta name="shinylive:serviceworker_dir" content=".">
<script src="site_libs/quarto-contrib/shinylive-0.9.1/shinylive/load-shinylive-sw.js" type="module"></script>
<script src="site_libs/quarto-contrib/shinylive-0.9.1/shinylive/run-python-blocks.js" type="module"></script>
<link href="site_libs/quarto-contrib/shinylive-0.9.1/shinylive/shinylive.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/shinylive-quarto-css/shinylive-quarto.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar docked quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./potential-outcomes.html">Framework</a></li><li class="breadcrumb-item"><a href="./identification-estimation.html">Identification vs Estimation</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Applied Causal Inference</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Framework</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./potential-outcomes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Potential Outcomes &amp; ATE</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./identification-estimation.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Identification vs Estimation</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Methods</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./selection-observables.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Selection on Observables</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./did.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Difference-in-Differences</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./iv.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Instrumental Variables</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rdd.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Regression Discontinuity</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./synth.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Synthetic Control</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Estimation Tools</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./regression-adjustment.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Regression Adjustment</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ipw.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">IPW</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./matching.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Matching</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./entropy-balancing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Entropy Balancing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./doubly-robust.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Doubly Robust</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#two-separate-questions-in-every-causal-study" id="toc-two-separate-questions-in-every-causal-study" class="nav-link active" data-scroll-target="#two-separate-questions-in-every-causal-study">Two separate questions in every causal study</a></li>
  <li><a href="#identification-the-assumption" id="toc-identification-the-assumption" class="nav-link" data-scroll-target="#identification-the-assumption">Identification: the assumption</a></li>
  <li><a href="#estimation-the-computation" id="toc-estimation-the-computation" class="nav-link" data-scroll-target="#estimation-the-computation">Estimation: the computation</a></li>
  <li><a href="#research-designs-bundle-both" id="toc-research-designs-bundle-both" class="nav-link" data-scroll-target="#research-designs-bundle-both">Research designs bundle both</a></li>
  <li><a href="#the-math-where-bias-comes-from" id="toc-the-math-where-bias-comes-from" class="nav-link" data-scroll-target="#the-math-where-bias-comes-from">The math: where bias comes from</a>
  <ul class="collapse">
  <li><a href="#selection-on-observables" id="toc-selection-on-observables" class="nav-link" data-scroll-target="#selection-on-observables">Selection on observables</a></li>
  <li><a href="#difference-in-differences" id="toc-difference-in-differences" class="nav-link" data-scroll-target="#difference-in-differences">Difference-in-differences</a></li>
  <li><a href="#instrumental-variables" id="toc-instrumental-variables" class="nav-link" data-scroll-target="#instrumental-variables">Instrumental variables</a></li>
  <li><a href="#threats-to-identification" id="toc-threats-to-identification" class="nav-link" data-scroll-target="#threats-to-identification">Threats to identification</a></li>
  <li><a href="#the-pattern" id="toc-the-pattern" class="nav-link" data-scroll-target="#the-pattern">The pattern</a></li>
  </ul></li>
  <li><a href="#types-of-bias" id="toc-types-of-bias" class="nav-link" data-scroll-target="#types-of-bias">Types of bias</a>
  <ul class="collapse">
  <li><a href="#identification-biases" id="toc-identification-biases" class="nav-link" data-scroll-target="#identification-biases">Identification biases</a></li>
  <li><a href="#estimation-biases" id="toc-estimation-biases" class="nav-link" data-scroll-target="#estimation-biases">Estimation biases</a></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul></li>
  <li><a href="#simulation-identification-matters-estimation-is-secondary" id="toc-simulation-identification-matters-estimation-is-secondary" class="nav-link" data-scroll-target="#simulation-identification-matters-estimation-is-secondary">Simulation: identification matters, estimation is secondary</a>
  <ul class="collapse">
  <li><a href="#things-to-try" id="toc-things-to-try" class="nav-link" data-scroll-target="#things-to-try">Things to try</a></li>
  </ul></li>
  <li><a href="#did-you-know" id="toc-did-you-know" class="nav-link" data-scroll-target="#did-you-know">Did you know?</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./potential-outcomes.html">Framework</a></li><li class="breadcrumb-item"><a href="./identification-estimation.html">Identification vs Estimation</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Identification vs Estimation</h1>
</div>



<div class="quarto-title-meta column-body">

    
  
    
  </div>
  


</header>


<section id="two-separate-questions-in-every-causal-study" class="level2">
<h2 class="anchored" data-anchor-id="two-separate-questions-in-every-causal-study">Two separate questions in every causal study</h2>
<p>Every causal inference project answers two fundamentally different questions:</p>
<ol type="1">
<li><strong>Identification.</strong> <em>Why</em> is this comparison causal? What assumptions make the estimand equal to the causal parameter?</li>
<li><strong>Estimation.</strong> <em>How</em> do we compute the estimand from data? What statistical procedure do we use?</li>
</ol>
<p>These are conceptually independent:</p>
<ul>
<li>You can have correct identification with a poor estimator (unbiased but noisy).</li>
<li>You can have a highly efficient estimator with no identification (precise but biased toward the wrong parameter).</li>
</ul>
<p><strong>Identification comes first.</strong> If the assumptions fail, no estimator can recover the causal effect.</p>
</section>
<section id="identification-the-assumption" class="level2">
<h2 class="anchored" data-anchor-id="identification-the-assumption">Identification: the assumption</h2>
<p>Identification is about the <strong>source of exogenous variation</strong> — why the variation in treatment you’re using is “as good as random” for estimating a causal effect.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th>Identification strategy</th>
<th>The assumption</th>
<th>In words</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Selection on observables</strong></td>
<td><span class="math inline">\(Y(0), Y(1) \perp D \mid X\)</span></td>
<td>Conditional on X, treatment is as good as random</td>
</tr>
<tr class="even">
<td><strong>Parallel trends</strong></td>
<td><span class="math inline">\(E[Y(0)_t - Y(0)_{t-1} \mid D=1] = E[Y(0)_t - Y(0)_{t-1} \mid D=0]\)</span></td>
<td>Absent treatment, both groups would have trended the same</td>
</tr>
<tr class="odd">
<td><strong>Exclusion restriction</strong></td>
<td><span class="math inline">\(Z\)</span> affects <span class="math inline">\(Y\)</span> only through <span class="math inline">\(X\)</span></td>
<td>The instrument has no direct effect on the outcome</td>
</tr>
<tr class="even">
<td><strong>Continuity</strong></td>
<td><span class="math inline">\(E[Y(0) \mid X=x]\)</span> is continuous at the cutoff</td>
<td>No other jump happens at the cutoff</td>
</tr>
</tbody>
</table>
<p>Each assumption is a <strong>claim about the world</strong> — not something you compute. You argue it using institutional knowledge, theory, and indirect evidence. Some are partially testable (you can check pre-trends for DID, run a McCrary test for RDD), but none can be fully proven from data.</p>
</section>
<section id="estimation-the-computation" class="level2">
<h2 class="anchored" data-anchor-id="estimation-the-computation">Estimation: the computation</h2>
<p>Estimation is about <strong>how you turn data into a number</strong>, given that you believe your identification assumption holds.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Estimator</th>
<th>What it does</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>OLS regression</strong></td>
<td>Fits a linear model, uses coefficients</td>
</tr>
<tr class="even">
<td><strong>Matching</strong></td>
<td>Pairs treated/control units with similar covariates</td>
</tr>
<tr class="odd">
<td><strong>IPW</strong></td>
<td>Reweights observations by inverse propensity scores</td>
</tr>
<tr class="even">
<td><strong>Entropy balancing</strong></td>
<td>Finds weights that exactly balance covariate moments</td>
</tr>
<tr class="odd">
<td><strong>Doubly robust</strong></td>
<td>Combines regression and weighting</td>
</tr>
<tr class="even">
<td><strong>2SLS</strong></td>
<td>Two-stage regression using predicted values from the first stage</td>
</tr>
<tr class="odd">
<td><strong>Local polynomial</strong></td>
<td>Fits flexible curves on each side of a cutoff</td>
</tr>
<tr class="even">
<td><strong>Synthetic control weights</strong></td>
<td>Constrained optimization to match pre-treatment trends</td>
</tr>
<tr class="odd">
<td><strong>TWFE</strong></td>
<td>Two-way fixed effects regression</td>
</tr>
</tbody>
</table>
<p>These are <strong>tools</strong> — they can often be combined with different identification strategies. IPW can implement selection on observables <em>or</em> be used in a DID design (IPW-DID). Regression can adjust for covariates in an RDD <em>or</em> in a cross-sectional study. The estimator doesn’t determine identification; the assumption does.</p>
</section>
<section id="research-designs-bundle-both" class="level2">
<h2 class="anchored" data-anchor-id="research-designs-bundle-both">Research designs bundle both</h2>
<p>What we usually call “methods” in applied work — DID, IV, RDD — are really <strong>research designs</strong> that bundle an identification strategy with a default estimator:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th>Research design</th>
<th>Identification</th>
<th>Common estimators</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>SOO study</strong></td>
<td>Conditional independence</td>
<td>Regression, matching, IPW, EB, doubly robust</td>
</tr>
<tr class="even">
<td><strong>DID</strong></td>
<td>Parallel trends</td>
<td>2×2 difference, TWFE, IPW-DID (Abadie 2005), DR-DID (Sant’Anna &amp; Zhao 2020)</td>
</tr>
<tr class="odd">
<td><strong>IV</strong></td>
<td>Exclusion restriction + relevance</td>
<td>2SLS, LIML, GMM</td>
</tr>
<tr class="even">
<td><strong>RDD</strong></td>
<td>Continuity at cutoff</td>
<td>Local polynomial, local randomization</td>
</tr>
<tr class="odd">
<td><strong>Synthetic control</strong></td>
<td>Pre-treatment fit → valid counterfactual</td>
<td>Constrained weight optimization, augmented SCM</td>
</tr>
</tbody>
</table>
<p>This is why the same estimation tool shows up in multiple designs. IPW appears in the SOO column <em>and</em> the DID column — because it’s a tool, not a strategy.</p>
<hr>
</section>
<section id="the-math-where-bias-comes-from" class="level2">
<h2 class="anchored" data-anchor-id="the-math-where-bias-comes-from">The math: where bias comes from</h2>
<p>When an identification assumption fails, it introduces a <strong>bias term</strong> that no estimator can remove. Here’s the decomposition for three methods.</p>
<section id="selection-on-observables" class="level3">
<h3 class="anchored" data-anchor-id="selection-on-observables">Selection on observables</h3>
<p>We want the Average Treatment Effect on the Treated (ATT):</p>
<p><span class="math display">\[\tau = E[Y(1) - Y(0) \mid D = 1]\]</span></p>
<p>We observe <span class="math inline">\(E[Y \mid D=1] = E[Y(1) \mid D=1]\)</span> and <span class="math inline">\(E[Y \mid D=0] = E[Y(0) \mid D=0]\)</span>. The naive comparison is:</p>
<p><span class="math display">\[E[Y \mid D=1] - E[Y \mid D=0] = \underbrace{E[Y(1) - Y(0) \mid D=1]}_{\text{ATT}} + \underbrace{E[Y(0) \mid D=1] - E[Y(0) \mid D=0]}_{\text{selection bias}}\]</span></p>
<p>The second term is <strong>selection bias</strong> — the treated group would have had different outcomes <em>even without treatment</em>. The CIA says: conditional on <span class="math inline">\(X\)</span>, <span class="math inline">\(E[Y(0) \mid D=1, X] = E[Y(0) \mid D=0, X]\)</span>, so the selection bias is zero within each stratum of <span class="math inline">\(X\)</span>.</p>
<p><strong>If the CIA fails</strong> — there’s an unobserved confounder <span class="math inline">\(U\)</span> — then <span class="math inline">\(E[Y(0) \mid D=1, X] \neq E[Y(0) \mid D=0, X]\)</span> because <span class="math inline">\(D\)</span> is still correlated with <span class="math inline">\(Y(0)\)</span> through <span class="math inline">\(U\)</span> even after conditioning on <span class="math inline">\(X\)</span>. The bias term is nonzero. Regression, IPW, matching — all give biased answers because the selection bias is <strong>baked into the estimand</strong>, not the estimator.</p>
</section>
<section id="difference-in-differences" class="level3">
<h3 class="anchored" data-anchor-id="difference-in-differences">Difference-in-differences</h3>
<p>The DID estimand is:</p>
<p><span class="math display">\[\hat{\tau}_{DID} = \big(E[Y_{1t}] - E[Y_{1,t-1}]\big) - \big(E[Y_{0t}] - E[Y_{0,t-1}]\big)\]</span></p>
<p>where group 1 is treated, group 0 is control, <span class="math inline">\(t\)</span> is post, <span class="math inline">\(t-1\)</span> is pre. Substitute potential outcomes and add and subtract <span class="math inline">\(E[Y_{1t}(0)]\)</span>:</p>
<p><span class="math display">\[\hat{\tau}_{DID} = \underbrace{E[Y_{1t}(1) - Y_{1t}(0)]}_{\text{ATT}} + \underbrace{\big(E[Y_{1t}(0)] - E[Y_{1,t-1}(0)]\big) - \big(E[Y_{0t}(0)] - E[Y_{0,t-1}(0)]\big)}_{\text{differential trend bias}}\]</span></p>
<p>The parallel trends assumption says the second term equals zero — the treated group’s <em>untreated</em> trajectory matches the control group’s trajectory. Then <span class="math inline">\(\hat{\tau}_{DID} = \text{ATT}\)</span>.</p>
<p><strong>If parallel trends fail</strong> — say the treated group was already trending upward faster — the differential trend term is positive. DID overestimates the effect. This bias doesn’t shrink with more data. It doesn’t go away if you switch from a 2×2 difference to TWFE or IPW-DID. It’s an identification failure, not an estimation failure.</p>
</section>
<section id="instrumental-variables" class="level3">
<h3 class="anchored" data-anchor-id="instrumental-variables">Instrumental variables</h3>
<p>We have <span class="math inline">\(Y = \beta X + \varepsilon\)</span> where <span class="math inline">\(\text{Cov}(X, \varepsilon) \neq 0\)</span> (endogeneity). The IV estimand is:</p>
<p><span class="math display">\[\hat{\beta}_{IV} = \frac{\text{Cov}(Z, Y)}{\text{Cov}(Z, X)}\]</span></p>
<p>Substitute <span class="math inline">\(Y = \beta X + \varepsilon\)</span>:</p>
<p><span class="math display">\[\hat{\beta}_{IV} = \frac{\text{Cov}(Z, \beta X + \varepsilon)}{\text{Cov}(Z, X)} = \beta + \frac{\text{Cov}(Z, \varepsilon)}{\text{Cov}(Z, X)}\]</span></p>
<p>The exclusion restriction says <span class="math inline">\(\text{Cov}(Z, \varepsilon) = 0\)</span> — the instrument is uncorrelated with the error. Then <span class="math inline">\(\hat{\beta}_{IV} = \beta\)</span>.</p>
<p><strong>If the exclusion restriction fails</strong> — <span class="math inline">\(Z\)</span> directly affects <span class="math inline">\(Y\)</span> through some channel other than <span class="math inline">\(X\)</span> — then <span class="math inline">\(\text{Cov}(Z, \varepsilon) \neq 0\)</span> and the bias term <span class="math inline">\(\frac{\text{Cov}(Z, \varepsilon)}{\text{Cov}(Z, X)}\)</span> is nonzero. No amount of data, no alternative estimator (LIML, GMM, jackknife) removes this. It’s baked in.</p>
</section>
<section id="threats-to-identification" class="level3">
<h3 class="anchored" data-anchor-id="threats-to-identification">Threats to identification</h3>
<p>Each method has specific threats — things that make the bias term nonzero:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>Method</th>
<th>Identification assumption</th>
<th>Threat (what breaks it)</th>
<th>What the bias looks like</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>SOO</strong></td>
<td>No unobserved confounders</td>
<td>Omitted variable that drives both <span class="math inline">\(D\)</span> and <span class="math inline">\(Y\)</span></td>
<td>Selection bias: treated group was different to begin with</td>
</tr>
<tr class="even">
<td><strong>DID</strong></td>
<td>Parallel trends</td>
<td>Treated group was already on a different trajectory</td>
<td>You attribute the pre-existing trend to the treatment</td>
</tr>
<tr class="odd">
<td><strong>IV</strong></td>
<td>Exclusion restriction</td>
<td>Instrument affects <span class="math inline">\(Y\)</span> through a channel other than <span class="math inline">\(X\)</span></td>
<td>IV picks up the direct effect, not just the causal path</td>
</tr>
<tr class="even">
<td><strong>RDD</strong></td>
<td>Continuity at cutoff</td>
<td>Units manipulate their score to sort across the cutoff; or another policy also kicks in at the same cutoff</td>
<td>The “jump” reflects sorting or a different treatment, not your treatment</td>
</tr>
<tr class="odd">
<td><strong>Synthetic control</strong></td>
<td>Pre-treatment fit generalizes</td>
<td>Spillovers from treated unit to donors; structural break changes the relationship</td>
<td>Counterfactual is wrong, gap doesn’t reflect the treatment</td>
</tr>
</tbody>
</table>
<p>Notice: every threat is about <strong>the world</strong>, not about <strong>the math</strong>. You can’t test your way out of these — you argue them with institutional knowledge.</p>
</section>
<section id="the-pattern" class="level3">
<h3 class="anchored" data-anchor-id="the-pattern">The pattern</h3>
<p>In all three cases:</p>
<p><span class="math display">\[\text{Estimate} = \text{Causal effect} + \text{Identification bias} + \text{Estimation bias}\]</span></p>
<p>Identification bias comes from violated assumptions — it’s a function of how the world works. Estimation bias comes from the estimator — it’s a function of how you computed the number. Identification bias dominates and can’t be fixed. Estimation bias is usually smaller and <em>can</em> be fixed by choosing a better estimator. That’s why identification comes first.</p>
<hr>
</section>
</section>
<section id="types-of-bias" class="level2">
<h2 class="anchored" data-anchor-id="types-of-bias">Types of bias</h2>
<section id="identification-biases" class="level3">
<h3 class="anchored" data-anchor-id="identification-biases">Identification biases</h3>
<p>These come from the world, not the estimator. More data doesn’t help. A fancier estimator doesn’t help. You need a <strong>different identification strategy</strong> or <strong>better data</strong>.</p>
<p><strong>Omitted variable bias (OVB).</strong> The most common. An unobserved variable <span class="math inline">\(U\)</span> affects both treatment and outcome. For the simple regression <span class="math inline">\(Y = \beta X + \gamma U + \varepsilon\)</span> where you omit <span class="math inline">\(U\)</span>:</p>
<p><span class="math display">\[\text{OVB} = \gamma \cdot \frac{\text{Cov}(X, U)}{\text{Var}(X)}\]</span></p>
<p>The bias is the effect of <span class="math inline">\(U\)</span> on <span class="math inline">\(Y\)</span> (<span class="math inline">\(\gamma\)</span>) times how much <span class="math inline">\(U\)</span> correlates with <span class="math inline">\(X\)</span>. If <span class="math inline">\(U\)</span> drives people toward treatment <em>and</em> improves outcomes, both terms are positive and you overestimate the effect.</p>
<p><strong>Selection bias.</strong> The treated group would have had different outcomes even without treatment: <span class="math inline">\(E[Y(0) \mid D=1] \neq E[Y(0) \mid D=0]\)</span>. This is OVB rephrased in potential outcomes language — the “omitted variable” is whatever drives people to select into treatment.</p>
<p><strong>Simultaneity bias.</strong> <span class="math inline">\(X\)</span> causes <span class="math inline">\(Y\)</span> but <span class="math inline">\(Y\)</span> also causes <span class="math inline">\(X\)</span>. Regressing <span class="math inline">\(Y\)</span> on <span class="math inline">\(X\)</span> picks up both directions. Common in macro (do interest rates affect GDP, or does GDP affect interest rates?) and in supply/demand estimation.</p>
<p><strong>Collider bias (sample selection bias).</strong> You condition on a variable caused by both treatment and outcome — this opens a fake path between them. The <a href="../stats-course/correlation-causation.html">correlation-causation page</a> covers this in detail.</p>
<p><strong>Differential trends bias.</strong> In DID: the treated group was already on a different trajectory before treatment. The estimate captures the pre-existing divergence, not the treatment effect.</p>
</section>
<section id="estimation-biases" class="level3">
<h3 class="anchored" data-anchor-id="estimation-biases">Estimation biases</h3>
<p>These come from the estimator, not the world. They can be reduced or eliminated by choosing a better estimator, using more data, or fixing the specification.</p>
<p><strong>Functional form misspecification.</strong> You fit a linear model but the truth is nonlinear. In RDD: a straight line through curved data creates a fake “jump” at the cutoff. Fix: use local polynomials, check robustness to specification.</p>
<p><strong>Finite sample / weak instrument bias.</strong> With weak instruments (<span class="math inline">\(F &lt; 10\)</span>), 2SLS is biased toward OLS in finite samples — even if the exclusion restriction holds. This shrinks with stronger instruments or alternative estimators (LIML, Anderson-Rubin).</p>
<p><strong>Negative weighting (TWFE with staggered treatment).</strong> Goodman-Bacon (2021) and de Chaisemartin &amp; d’Haultfoeuille (2020) showed that two-way fixed effects can produce negative weights on some treatment effects when treatment is staggered across time — giving biased estimates even when parallel trends holds. Fix: use Callaway &amp; Sant’Anna, Sun &amp; Abraham, or other heterogeneity-robust estimators.</p>
<p><strong>Extreme weights.</strong> In IPW: when propensity scores are near 0 or 1, some observations get enormous weights, making the estimate noisy and potentially biased in finite samples. Fix: trim extreme scores, use entropy balancing, or use doubly robust estimators.</p>
<p><strong>Attenuation bias (measurement error).</strong> When <span class="math inline">\(X\)</span> is measured with noise, OLS is biased toward zero. The noisier the measurement relative to the true signal, the more the estimate shrinks. Can be fixed with better measurement or IV. See the <a href="../stats-course/measurement-error.html">measurement error page</a> for the signal-to-noise ratio formula.</p>
</section>
<section id="summary" class="level3">
<h3 class="anchored" data-anchor-id="summary">Summary</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>Bias</th>
<th>Type</th>
<th>Goes away with more data?</th>
<th>Fix</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Omitted variable / confounding</td>
<td>Identification</td>
<td>No</td>
<td>Better controls, different strategy (IV, DID, RDD)</td>
</tr>
<tr class="even">
<td>Selection bias</td>
<td>Identification</td>
<td>No</td>
<td>Randomization, or argue CIA</td>
</tr>
<tr class="odd">
<td>Simultaneity</td>
<td>Identification</td>
<td>No</td>
<td>IV, timing restrictions</td>
</tr>
<tr class="even">
<td>Collider / sample selection</td>
<td>Identification</td>
<td>No</td>
<td>Don’t condition on colliders</td>
</tr>
<tr class="odd">
<td>Differential trends</td>
<td>Identification</td>
<td>No</td>
<td>Different comparison group, different strategy</td>
</tr>
<tr class="even">
<td>Functional form</td>
<td>Estimation</td>
<td>Partially</td>
<td>Flexible specifications, local methods</td>
</tr>
<tr class="odd">
<td>Weak instruments</td>
<td>Estimation</td>
<td>Partially</td>
<td>Stronger instruments, LIML</td>
</tr>
<tr class="even">
<td>TWFE negative weighting</td>
<td>Estimation</td>
<td>No</td>
<td>Heterogeneity-robust DID estimators</td>
</tr>
<tr class="odd">
<td>Extreme IPW weights</td>
<td>Estimation</td>
<td>Yes (slowly)</td>
<td>Trimming, EB, doubly robust</td>
</tr>
<tr class="even">
<td>Attenuation (measurement error)</td>
<td>Both</td>
<td>No</td>
<td>Better data, IV</td>
</tr>
</tbody>
</table>
<hr>
</section>
</section>
<section id="simulation-identification-matters-estimation-is-secondary" class="level2">
<h2 class="anchored" data-anchor-id="simulation-identification-matters-estimation-is-secondary">Simulation: identification matters, estimation is secondary</h2>
<p>Same data, same identification assumption, three different estimators. When the assumption holds, they all work. When it doesn’t, they all fail.</p>
<pre class="shinylive-r" data-engine="r"><code>#| standalone: true
#| viewerHeight: 580

library(shiny)

ui &lt;- fluidPage(
  tags$head(tags$style(HTML("
    .stats-box {
      background: #f0f4f8; border-radius: 6px; padding: 14px;
      margin-top: 12px; font-size: 13px; line-height: 1.8;
    }
    .stats-box b { color: #2c3e50; }
    .good { color: #27ae60; font-weight: bold; }
    .bad  { color: #e74c3c; font-weight: bold; }
  "))),

  sidebarLayout(
    sidebarPanel(
      width = 3,

      sliderInput("n_ie", "Sample size:",
                  min = 200, max = 2000, value = 500, step = 100),

      sliderInput("ate_ie", "True ATE:",
                  min = 0, max = 5, value = 2, step = 0.5),

      sliderInput("obs_ie", "Observed confounding (X):",
                  min = 0, max = 3, value = 1.5, step = 0.25),

      sliderInput("unobs_ie", "Unobserved confounding (U):",
                  min = 0, max = 3, value = 0, step = 0.25),

      actionButton("go_ie", "New draw", class = "btn-primary", width = "100%"),

      uiOutput("results_ie")
    ),

    mainPanel(
      width = 9,
      plotOutput("ie_plot", height = "420px")
    )
  )
)

server &lt;- function(input, output, session) {

  dat &lt;- reactive({
    input$go_ie
    n   &lt;- input$n_ie
    ate &lt;- input$ate_ie
    gx  &lt;- input$obs_ie
    gu  &lt;- input$unobs_ie

    x &lt;- rnorm(n)
    u &lt;- rnorm(n)

    p &lt;- pnorm(gx * x + gu * u)
    treat &lt;- rbinom(n, 1, p)

    y &lt;- 1 + 2 * x + 1.5 * u + ate * treat + rnorm(n)

    # Estimator 1: OLS regression controlling for X
    est_reg &lt;- coef(lm(y ~ treat + x))[2]

    # Estimator 2: IPW
    ps &lt;- fitted(glm(treat ~ x, family = binomial))
    ps &lt;- pmin(pmax(ps, 0.01), 0.99)
    w &lt;- ifelse(treat == 1, 1 / ps, 1 / (1 - ps))
    est_ipw &lt;- weighted.mean(y[treat == 1], w[treat == 1]) -
               weighted.mean(y[treat == 0], w[treat == 0])

    # Estimator 3: Matching (simple: nearest neighbor on X)
    matched_y &lt;- numeric(sum(treat == 1))
    x_t &lt;- x[treat == 1]
    y_t &lt;- y[treat == 1]
    x_c &lt;- x[treat == 0]
    y_c &lt;- y[treat == 0]
    for (i in seq_along(x_t)) {
      nearest &lt;- which.min(abs(x_c - x_t[i]))
      matched_y[i] &lt;- y_c[nearest]
    }
    est_match &lt;- mean(y_t) - mean(matched_y)

    list(est_reg = est_reg, est_ipw = est_ipw, est_match = est_match,
         ate = ate, gu = gu)
  })

  output$ie_plot &lt;- renderPlot({
    d &lt;- dat()
    par(mar = c(5, 4.5, 3, 1))

    estimates &lt;- c(d$est_reg, d$est_ipw, d$est_match)
    biases &lt;- estimates - d$ate
    labels &lt;- c("OLS\nregression", "IPW", "Nearest-neighbor\nmatching")

    cia_holds &lt;- d$gu == 0
    cols &lt;- ifelse(abs(biases) &lt; 0.5, "#27ae60", "#e74c3c")

    bp &lt;- barplot(estimates, col = cols, border = NA,
                  names.arg = labels, cex.names = 0.85,
                  main = ifelse(cia_holds,
                    "CIA holds: all estimators work",
                    "CIA violated: all estimators fail"),
                  ylab = "Estimate",
                  ylim = c(0, max(estimates, d$ate) * 1.5))

    abline(h = d$ate, lty = 2, col = "gray40", lwd = 2)
    text(0.2, d$ate + 0.15, paste0("True ATE = ", d$ate),
         col = "gray40", cex = 0.85, adj = 0)

    text(bp, estimates + 0.2,
         paste0(round(estimates, 2)),
         cex = 0.9, font = 2)
  })

  output$results_ie &lt;- renderUI({
    d &lt;- dat()
    cia_holds &lt;- d$gu == 0

    tags$div(class = "stats-box",
      HTML(paste0(
        "&lt;b&gt;True ATE:&lt;/b&gt; ", d$ate, "&lt;br&gt;",
        "&lt;hr style='margin:6px 0'&gt;",
        "&lt;b&gt;Regression:&lt;/b&gt; ", round(d$est_reg, 2),
        " (bias: ", round(d$est_reg - d$ate, 2), ")&lt;br&gt;",
        "&lt;b&gt;IPW:&lt;/b&gt; ", round(d$est_ipw, 2),
        " (bias: ", round(d$est_ipw - d$ate, 2), ")&lt;br&gt;",
        "&lt;b&gt;Matching:&lt;/b&gt; ", round(d$est_match, 2),
        " (bias: ", round(d$est_match - d$ate, 2), ")&lt;br&gt;",
        "&lt;hr style='margin:6px 0'&gt;",
        if (cia_holds)
          "&lt;span class='good'&gt;CIA holds.&lt;/span&gt; All three estimators give similar, roughly unbiased answers. The choice of estimator is secondary."
        else
          "&lt;span class='bad'&gt;CIA violated.&lt;/span&gt; All three estimators are biased. Switching estimators doesn't help — you need a different identification strategy."
      ))
    )
  })
}

shinyApp(ui, server)</code></pre>
<section id="things-to-try" class="level3">
<h3 class="anchored" data-anchor-id="things-to-try">Things to try</h3>
<ul>
<li><strong>Unobserved confounding = 0:</strong> the CIA holds. All three estimators — regression, IPW, matching — give roughly the same answer, close to the true ATE. The choice between them is about efficiency, not bias.</li>
<li><strong>Unobserved confounding = 2:</strong> the CIA is violated. All three estimators are biased in the same direction. Switching from regression to IPW to matching doesn’t help — the problem is identification, not estimation.</li>
<li><strong>Increase sample size with unobserved confounding:</strong> all three get more <em>precise</em> but stay <em>biased</em>. More data doesn’t fix a broken assumption.</li>
</ul>
<p>The lesson: <strong>spend your energy on identification, not on the fanciest estimator.</strong></p>
<hr>
</section>
</section>
<section id="did-you-know" class="level2">
<h2 class="anchored" data-anchor-id="did-you-know">Did you know?</h2>
<ul>
<li><p>The distinction between identification and estimation was articulated clearly by <strong>Charles Manski</strong> in his 1995 book <em>Identification Problems in the Social Sciences</em>. He argued that most debates in empirical work are really about identification, not estimation.</p></li>
<li><p><strong>Angrist &amp; Pischke</strong> (<em>Mostly Harmless Econometrics</em>, 2009) organized their entire textbook around identification strategies — regression, IV, DID, RDD — rather than estimators. This framing reshaped how a generation of economists thinks about empirical work.</p></li>
<li><p>A common mistake in applied papers: spending pages discussing the estimator (clustered SEs, bootstrap, semiparametric methods) while spending one paragraph on identification. The estimator is the easy part. The hard part is arguing that your comparison is causal.</p></li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>© 2026 <a href="https://nencydhameja.com">Nency Dhameja</a> | <a href="../index.html">All Notes</a><br>Inspired by my advisor, <a href="https://sites.google.com/site/slichterdavid/home">David Slichter</a> · Developed with AI assistance</p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>