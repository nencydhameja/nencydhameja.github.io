<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.27">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>From Correlation to Causation – Foundations of Statistical Inference</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-ed96de9b727972fe78a7b5d16c58bf87.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-d279e387f5997211c97d65d1670dc95e.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<meta name="shinylive:serviceworker_dir" content=".">
<script src="site_libs/quarto-contrib/shinylive-0.9.1/shinylive/load-shinylive-sw.js" type="module"></script>
<script src="site_libs/quarto-contrib/shinylive-0.9.1/shinylive/run-python-blocks.js" type="module"></script>
<link href="site_libs/quarto-contrib/shinylive-0.9.1/shinylive/shinylive.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/shinylive-quarto-css/shinylive-quarto.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar docked quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./correlation-causation.html">Causal Thinking</a></li><li class="breadcrumb-item"><a href="./correlation-causation.html">From Correlation to Causation</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Foundations of Statistical Inference</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Probability &amp; Uncertainty</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./foundations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Foundations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./variance-sd-se.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variance, SD &amp; Standard Error</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./sampling-distribution.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The Sampling Distribution</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">The Central Limit Theorem</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./simulations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">CLT Simulator</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lln.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">LLN vs CLT</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Inference</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./pvalues-ci.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">p-values &amp; Confidence Intervals</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bootstrap.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The Bootstrap</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./power.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Power, Alpha, Beta &amp; MDE</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./monte-carlo.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Monte Carlo Experiments</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./multiple-testing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multiple Testing</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Regression</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./cef.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Regression &amp; the CEF</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./residuals.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Residuals &amp; Controls</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./fwl.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Frisch-Waugh-Lovell</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Standard Errors &amp; Diagnostics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./heteroskedasticity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Heteroskedasticity</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./clustered-se.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Clustered SEs</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./measurement-error.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Measurement Error</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bias-variance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bias-Variance Tradeoff</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./degeneracy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">When Inference Breaks Down</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Causal Thinking</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./correlation-causation.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">From Correlation to Causation</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Bayesian Thinking</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bayesian-updating.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Updating</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#the-regression-slope-is-a-correlation" id="toc-the-regression-slope-is-a-correlation" class="nav-link active" data-scroll-target="#the-regression-slope-is-a-correlation">The regression slope is a correlation</a></li>
  <li><a href="#so-you-see-a-correlation.-now-what" id="toc-so-you-see-a-correlation.-now-what" class="nav-link" data-scroll-target="#so-you-see-a-correlation.-now-what">So you see a correlation. Now what?</a></li>
  <li><a href="#simulation-1-same-scatter-plot-different-causal-stories" id="toc-simulation-1-same-scatter-plot-different-causal-stories" class="nav-link" data-scroll-target="#simulation-1-same-scatter-plot-different-causal-stories">Simulation 1: Same scatter plot, different causal stories</a>
  <ul class="collapse">
  <li><a href="#things-to-try" id="toc-things-to-try" class="nav-link" data-scroll-target="#things-to-try">Things to try</a></li>
  </ul></li>
  <li><a href="#simulation-2-randomization-breaks-confounding" id="toc-simulation-2-randomization-breaks-confounding" class="nav-link" data-scroll-target="#simulation-2-randomization-breaks-confounding">Simulation 2: Randomization breaks confounding</a>
  <ul class="collapse">
  <li><a href="#things-to-try-1" id="toc-things-to-try-1" class="nav-link" data-scroll-target="#things-to-try-1">Things to try</a></li>
  </ul></li>
  <li><a href="#digging-deeper-why-correlations-mislead" id="toc-digging-deeper-why-correlations-mislead" class="nav-link" data-scroll-target="#digging-deeper-why-correlations-mislead">Digging deeper: why correlations mislead</a>
  <ul class="collapse">
  <li><a href="#spurious-correlation-why-unrelated-things-look-related" id="toc-spurious-correlation-why-unrelated-things-look-related" class="nav-link" data-scroll-target="#spurious-correlation-why-unrelated-things-look-related">Spurious correlation: why unrelated things look related</a></li>
  <li><a href="#collider-bias-the-trickiest-one" id="toc-collider-bias-the-trickiest-one" class="nav-link" data-scroll-target="#collider-bias-the-trickiest-one">Collider bias: the trickiest one</a></li>
  </ul></li>
  <li><a href="#when-does-correlation-become-causation" id="toc-when-does-correlation-become-causation" class="nav-link" data-scroll-target="#when-does-correlation-become-causation">When does correlation become causation?</a></li>
  <li><a href="#did-you-know" id="toc-did-you-know" class="nav-link" data-scroll-target="#did-you-know">Did you know?</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./correlation-causation.html">Causal Thinking</a></li><li class="breadcrumb-item"><a href="./correlation-causation.html">From Correlation to Causation</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">From Correlation to Causation</h1>
</div>



<div class="quarto-title-meta column-body">

    
  
    
  </div>
  


</header>


<section id="the-regression-slope-is-a-correlation" class="level2">
<h2 class="anchored" data-anchor-id="the-regression-slope-is-a-correlation">The regression slope is a correlation</h2>
<p>On the <a href="cef.html">Regression &amp; CEF</a> page, you learned that OLS estimates the best linear approximation to <span class="math inline">\(E[Y \mid X]\)</span>. The slope <span class="math inline">\(\hat{\beta}\)</span> tells you: <em>when X is one unit higher, Y is on average <span class="math inline">\(\hat{\beta}\)</span> units higher.</em> But “higher” is not “caused by.” The slope measures how X and Y <strong>move together</strong> — that’s correlation. In fact:</p>
<p><span class="math display">\[\hat{\beta} = \frac{\text{Cov}(X, Y)}{\text{Var}(X)} = r_{XY} \cdot \frac{SD(Y)}{SD(X)}\]</span></p>
<p>It’s literally a rescaled correlation coefficient. A significant slope means X and Y are associated. It says nothing about <em>why</em>.</p>
</section>
<section id="so-you-see-a-correlation.-now-what" class="level2">
<h2 class="anchored" data-anchor-id="so-you-see-a-correlation.-now-what">So you see a correlation. Now what?</h2>
<p>Your slope is positive, your p-value is small. <strong>But why are X and Y correlated?</strong></p>
<p>There are exactly five possibilities:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Reason</th>
<th>Structure</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>X causes Y</strong></td>
<td><span class="math inline">\(X \to Y\)</span></td>
<td>Exercise → lower blood pressure</td>
</tr>
<tr class="even">
<td><strong>Y causes X</strong></td>
<td><span class="math inline">\(Y \to X\)</span></td>
<td>Higher income → more education (you can afford grad school)</td>
</tr>
<tr class="odd">
<td><strong>Something else causes both</strong></td>
<td><span class="math inline">\(Z \to X\)</span>, <span class="math inline">\(Z \to Y\)</span></td>
<td>Family background → education AND income</td>
</tr>
<tr class="even">
<td><strong>Spurious correlation</strong></td>
<td>No real connection</td>
<td><a href="https://tylervigen.com/spurious-correlations">US spending on science correlates with suicides by hanging</a></td>
</tr>
<tr class="odd">
<td><strong>You conditioned on a common effect</strong></td>
<td>Collider bias</td>
<td>Among hospitalized patients, two unrelated diseases look negatively correlated</td>
</tr>
</tbody>
</table>
<p>Here’s the problem: <strong>all five produce the same scatter plot.</strong> A positive slope between X and Y looks identical whether X actually causes Y, or a confounder drives both, or it’s pure coincidence. The data can’t tell you <em>which</em> story is true — only theory, study design, and assumptions can.</p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>The Oracle vs Reality.</strong> In these simulations, we build the causal structure — we decide what causes what. We can compare the true causal effect with what a naive regression estimates. In practice, you never see the causal structure. You see the data and have to argue — using design, theory, and assumptions — that your estimate is causal.</p>
</div>
</div>
</div>
<hr>
</section>
<section id="simulation-1-same-scatter-plot-different-causal-stories" class="level2">
<h2 class="anchored" data-anchor-id="simulation-1-same-scatter-plot-different-causal-stories">Simulation 1: Same scatter plot, different causal stories</h2>
<p>Three different causal structures — all producing <strong>the same correlation</strong> between X and Y. Drag the sliders and watch: the scatter plots are indistinguishable, but the true causal effect of X on Y is completely different in each case.</p>
<pre class="shinylive-r" data-engine="r"><code>#| standalone: true
#| viewerHeight: 520

library(shiny)

ui &lt;- fluidPage(
  tags$head(tags$style(HTML("
    .stats-box {
      background: #f0f4f8; border-radius: 6px; padding: 14px;
      margin-top: 8px; font-size: 13px; line-height: 1.7;
    }
    .stats-box b { color: #2c3e50; }
    .causal  { color: #27ae60; font-weight: bold; }
    .mislead { color: #e74c3c; font-weight: bold; }
  "))),

  sidebarLayout(
    sidebarPanel(
      width = 4,

      sliderInput("n1", "Sample size:",
                  min = 100, max = 500, value = 300, step = 50),

      sliderInput("true_effect", "True causal effect of X on Y:",
                  min = 0, max = 2, value = 0, step = 0.1),

      sliderInput("confound", "Confounding strength (Z on both):",
                  min = 0, max = 3, value = 2, step = 0.25),

      uiOutput("results1")
    ),

    mainPanel(
      width = 8,
      fluidRow(
        column(4, plotOutput("plot_causal", height = "260px")),
        column(4, plotOutput("plot_confound", height = "260px")),
        column(4, plotOutput("plot_reverse", height = "260px"))
      )
    )
  )
)

server &lt;- function(input, output, session) {

  sim &lt;- reactive({
    n  &lt;- input$n1
    b  &lt;- input$true_effect
    cf &lt;- input$confound

    set.seed(42)
    z &lt;- rnorm(n)
    noise_x &lt;- rnorm(n)
    noise_y &lt;- rnorm(n)

    # Story 1: X causes Y (true effect = b, no confounding)
    x1 &lt;- noise_x
    y1 &lt;- b * x1 + noise_y

    # Story 2: Confounding — Z causes both X and Y
    x2 &lt;- cf * z + noise_x
    y2 &lt;- b * x2 + cf * z + noise_y

    # Story 3: Reverse causality — Y causes X
    y3 &lt;- cf * z + noise_y
    x3 &lt;- 1.5 * y3 + noise_x

    fit1 &lt;- lm(y1 ~ x1)
    fit2 &lt;- lm(y2 ~ x2)
    fit3 &lt;- lm(y3 ~ x3)

    list(x1 = x1, y1 = y1, x2 = x2, y2 = y2, x3 = x3, y3 = y3,
         b1 = coef(fit1)[2], b2 = coef(fit2)[2], b3 = coef(fit3)[2],
         true_b = b, confound = cf)
  })

  output$plot_causal &lt;- renderPlot({
    d &lt;- sim()
    par(mar = c(3, 3, 2, 0.5), cex.axis = 0.8, cex.lab = 0.9, cex.main = 0.85)
    plot(d$x1, d$y1, pch = 16, cex = 0.5,
         col = adjustcolor("#3498db", 0.4),
         xlab = "X", ylab = "Y",
         main = expression("Story 1: X causes Y  (" * X %-&gt;% Y * ")"))
    abline(lm(d$y1 ~ d$x1), col = "#e74c3c", lwd = 3)
    legend("topleft", bty = "n", cex = 0.8,
           legend = paste0("OLS slope = ", round(d$b1, 2),
                           "  |  True effect = ", d$true_b),
           text.col = if (abs(d$b1 - d$true_b) &lt; 0.15) "#27ae60" else "#e74c3c",
           text.font = 2)
  })

  output$plot_confound &lt;- renderPlot({
    d &lt;- sim()
    par(mar = c(3, 3, 2, 0.5), cex.axis = 0.8, cex.lab = 0.9, cex.main = 0.85)
    plot(d$x2, d$y2, pch = 16, cex = 0.5,
         col = adjustcolor("#3498db", 0.4),
         xlab = "X", ylab = "Y",
         main = expression("Story 2: Confounding  (" * Z %-&gt;% X * "," ~~ Z %-&gt;% Y * ")"))
    abline(lm(d$y2 ~ d$x2), col = "#e74c3c", lwd = 3)
    legend("topleft", bty = "n", cex = 0.8,
           legend = paste0("OLS slope = ", round(d$b2, 2),
                           "  |  True effect = ", d$true_b,
                           "  [BIASED]"),
           text.col = "#e74c3c", text.font = 2)
  })

  output$plot_reverse &lt;- renderPlot({
    d &lt;- sim()
    par(mar = c(3, 3, 2, 0.5), cex.axis = 0.8, cex.lab = 0.9, cex.main = 0.85)
    plot(d$x3, d$y3, pch = 16, cex = 0.5,
         col = adjustcolor("#3498db", 0.4),
         xlab = "X", ylab = "Y",
         main = expression("Story 3: Reverse causality  (" * Y %-&gt;% X * ")"))
    abline(lm(d$y3 ~ d$x3), col = "#e74c3c", lwd = 3)
    legend("topleft", bty = "n", cex = 0.8,
           legend = paste0("OLS slope = ", round(d$b3, 2),
                           "  |  True effect = 0  [MISLEADING]"),
           text.col = "#e74c3c", text.font = 2)
  })

  output$results1 &lt;- renderUI({
    d &lt;- sim()

    tags$div(class = "stats-box",
      HTML(paste0(
        "&lt;b&gt;X \u2192 Y (no confounding):&lt;/b&gt;&lt;br&gt;",
        "OLS = ", round(d$b1, 3),
        " | True = ", d$true_b,
        if (abs(d$b1 - d$true_b) &lt; 0.15)
          " &lt;span class='causal'&gt;\u2713&lt;/span&gt;" else "", "&lt;br&gt;",
        "&lt;hr style='margin:6px 0'&gt;",
        "&lt;b&gt;Z \u2192 X, Z \u2192 Y (confounding):&lt;/b&gt;&lt;br&gt;",
        "OLS = ", round(d$b2, 3),
        " | True = ", d$true_b,
        " &lt;span class='mislead'&gt;biased&lt;/span&gt;&lt;br&gt;",
        "&lt;hr style='margin:6px 0'&gt;",
        "&lt;b&gt;Y \u2192 X (reverse causality):&lt;/b&gt;&lt;br&gt;",
        "OLS = ", round(d$b3, 3),
        " | True = 0",
        " &lt;span class='mislead'&gt;misleading&lt;/span&gt;"
      ))
    )
  })
}

shinyApp(ui, server)</code></pre>
<section id="things-to-try" class="level3">
<h3 class="anchored" data-anchor-id="things-to-try">Things to try</h3>
<ul>
<li><strong>True effect = 0, confounding = 2:</strong> all three panels show a positive correlation. But only in panel 1 is the causal effect actually zero <em>and</em> the OLS slope correct. In panels 2 and 3, the correlation is entirely spurious — driven by confounding or reverse causality.</li>
<li><strong>True effect = 1, confounding = 2:</strong> panel 1 recovers the true effect. Panel 2 overestimates it (confounding adds to the slope). Panel 3 shows something completely unrelated.</li>
<li><strong>Increase sample size:</strong> all three slopes get <em>more precise</em> — but the biased ones stay biased. More data doesn’t fix confounding. It just gives you a more precise wrong answer.</li>
</ul>
<hr>
</section>
</section>
<section id="simulation-2-randomization-breaks-confounding" class="level2">
<h2 class="anchored" data-anchor-id="simulation-2-randomization-breaks-confounding">Simulation 2: Randomization breaks confounding</h2>
<p>This is the fundamental insight of causal inference: <strong>randomization makes X independent of everything else</strong>, so the only reason Y changes with X is the causal effect.</p>
<p>Compare an observational study (where confounding biases the estimate) with a randomized experiment (where the bias disappears).</p>
<pre class="shinylive-r" data-engine="r"><code>#| standalone: true
#| viewerHeight: 700

library(shiny)

ui &lt;- fluidPage(
  tags$head(tags$style(HTML("
    .stats-box {
      background: #f0f4f8; border-radius: 6px; padding: 14px;
      margin-top: 12px; font-size: 14px; line-height: 1.9;
    }
    .stats-box b { color: #2c3e50; }
    .good { color: #27ae60; font-weight: bold; }
    .bad  { color: #e74c3c; font-weight: bold; }
  "))),

  sidebarLayout(
    sidebarPanel(
      width = 4,

      sliderInput("n2", "Sample size:",
                  min = 100, max = 500, value = 200, step = 50),

      sliderInput("true_b", "True causal effect of treatment:",
                  min = 0, max = 5, value = 2, step = 0.25),

      sliderInput("confound2", "Confounding strength:",
                  min = 0, max = 5, value = 3, step = 0.25),

      uiOutput("results2")
    ),

    mainPanel(
      width = 8,
      plotOutput("rct_plot", height = "550px")
    )
  )
)

server &lt;- function(input, output, session) {

  sim &lt;- reactive({
    n  &lt;- input$n2
    b  &lt;- input$true_b
    cf &lt;- input$confound2

    # Confounder: ability, motivation, etc.
    z &lt;- rnorm(n)

    # Observational: treatment correlated with confounder
    # (motivated people self-select into treatment)
    prob_treat &lt;- plogis(cf * z)
    treat_obs  &lt;- rbinom(n, 1, prob_treat)
    y_obs      &lt;- b * treat_obs + 2 * z + rnorm(n)
    fit_obs    &lt;- lm(y_obs ~ treat_obs)

    # RCT: treatment is random (coin flip)
    treat_rct &lt;- rbinom(n, 1, 0.5)
    y_rct     &lt;- b * treat_rct + 2 * z + rnorm(n)
    fit_rct   &lt;- lm(y_rct ~ treat_rct)

    list(treat_obs = treat_obs, y_obs = y_obs,
         treat_rct = treat_rct, y_rct = y_rct,
         z = z, b_obs = coef(fit_obs)[2], b_rct = coef(fit_rct)[2],
         true_b = b, confound = cf)
  })

  output$rct_plot &lt;- renderPlot({
    d &lt;- sim()
    par(mfrow = c(1, 2), mar = c(5, 5, 4, 2))

    # Left: Observational
    cols_obs &lt;- ifelse(d$treat_obs == 1, "#e74c3c", "#3498db")
    stripchart(d$y_obs ~ d$treat_obs,
               method = "jitter", jitter = 0.15,
               vertical = TRUE, pch = 16, cex = 0.6,
               col = adjustcolor(cols_obs, 0.4),
               group.names = c("Control", "Treated"),
               xlab = "", ylab = "Outcome (Y)",
               main = "Observational study")

    means_obs &lt;- tapply(d$y_obs, d$treat_obs, mean)
    segments(0.8, means_obs[1], 1.2, means_obs[1],
             col = "#3498db", lwd = 3)
    segments(1.8, means_obs[2], 2.2, means_obs[2],
             col = "#e74c3c", lwd = 3)

    mtext(paste0("Difference = ", round(d$b_obs, 2),
                 "  (true = ", d$true_b, ")"),
          side = 3, line = 0, cex = 1, font = 2, col = "#e74c3c")

    # Right: RCT
    cols_rct &lt;- ifelse(d$treat_rct == 1, "#e74c3c", "#3498db")
    stripchart(d$y_rct ~ d$treat_rct,
               method = "jitter", jitter = 0.15,
               vertical = TRUE, pch = 16, cex = 0.6,
               col = adjustcolor(cols_rct, 0.4),
               group.names = c("Control", "Treated"),
               xlab = "", ylab = "Outcome (Y)",
               main = "Randomized experiment")

    means_rct &lt;- tapply(d$y_rct, d$treat_rct, mean)
    segments(0.8, means_rct[1], 1.2, means_rct[1],
             col = "#3498db", lwd = 3)
    segments(1.8, means_rct[2], 2.2, means_rct[2],
             col = "#e74c3c", lwd = 3)

    mtext(paste0("Difference = ", round(d$b_rct, 2),
                 "  (true = ", d$true_b, ")"),
          side = 3, line = 0, cex = 1, font = 2, col = "#27ae60")
  })

  output$results2 &lt;- renderUI({
    d &lt;- sim()

    bias_obs &lt;- d$b_obs - d$true_b
    bias_rct &lt;- d$b_rct - d$true_b

    tags$div(class = "stats-box",
      HTML(paste0(
        "&lt;b&gt;True causal effect:&lt;/b&gt; ", d$true_b, "&lt;br&gt;",
        "&lt;hr style='margin:6px 0'&gt;",
        "&lt;b&gt;Observational:&lt;/b&gt; ", round(d$b_obs, 3),
        "&lt;br&gt;Bias: &lt;span class='bad'&gt;",
        round(bias_obs, 3), "&lt;/span&gt;&lt;br&gt;",
        "&lt;small&gt;Treated group has higher ability",
        " (selection bias)&lt;/small&gt;",
        "&lt;hr style='margin:6px 0'&gt;",
        "&lt;b&gt;Randomized:&lt;/b&gt; ", round(d$b_rct, 3),
        "&lt;br&gt;Bias: &lt;span class='good'&gt;",
        round(bias_rct, 3), "&lt;/span&gt;&lt;br&gt;",
        "&lt;small&gt;Treatment is independent of",
        " everything \u2192 unbiased&lt;/small&gt;"
      ))
    )
  })
}

shinyApp(ui, server)</code></pre>
<section id="things-to-try-1" class="level3">
<h3 class="anchored" data-anchor-id="things-to-try-1">Things to try</h3>
<ul>
<li><strong>True effect = 2, confounding = 3:</strong> the observational study overestimates the effect (maybe by 50–100%) because motivated people self-select into treatment. The RCT nails it.</li>
<li><strong>True effect = 0, confounding = 3:</strong> the treatment does <em>nothing</em>, but the observational study finds a large “effect” — entirely driven by selection bias. The RCT correctly shows ~0.</li>
<li><strong>Confounding = 0:</strong> both studies agree. When there’s no confounding, observational data works fine. The problem is you never know if confounding is zero in practice.</li>
<li><strong>Increase n:</strong> both estimates get more precise, but the observational one stays biased. <strong>Sample size doesn’t fix confounding.</strong></li>
</ul>
<hr>
</section>
</section>
<section id="digging-deeper-why-correlations-mislead" class="level2">
<h2 class="anchored" data-anchor-id="digging-deeper-why-correlations-mislead">Digging deeper: why correlations mislead</h2>
<section id="spurious-correlation-why-unrelated-things-look-related" class="level3">
<h3 class="anchored" data-anchor-id="spurious-correlation-why-unrelated-things-look-related">Spurious correlation: why unrelated things look related</h3>
<p>A <strong>spurious correlation</strong> is a correlation between two variables that have no causal connection whatsoever. It’s not confounding (no hidden Z), not reverse causality — it’s pure noise that <em>looks</em> like signal.</p>
<p><strong>Why does it happen?</strong> If <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> are truly independent, then <span class="math inline">\(\text{Cor}(X, Y) = 0\)</span> in the population. But in a finite sample, the sample correlation <span class="math inline">\(r_{XY}\)</span> is almost never exactly zero. It has sampling variability:</p>
<p><span class="math display">\[\text{Var}(r_{XY}) \approx \frac{1}{n}\]</span></p>
<p>With small <span class="math inline">\(n\)</span>, the sample correlation can be large purely by chance. With <span class="math inline">\(n = 10\)</span>, a correlation of <span class="math inline">\(r = 0.5\)</span> between two completely independent variables isn’t unusual at all.</p>
<p><strong>Multiple testing makes it worse.</strong> If you compute correlations between <span class="math inline">\(k\)</span> pairs of unrelated variables and test each at <span class="math inline">\(\alpha = 0.05\)</span>, the probability that at least one comes up “significant” is:</p>
<p><span class="math display">\[P(\text{at least one false positive}) = 1 - (1 - 0.05)^k\]</span></p>
<p>With <span class="math inline">\(k = 20\)</span> pairs, that’s a 64% chance. With <span class="math inline">\(k = 100\)</span>, it’s 99.4%. Test enough things and you <em>will</em> find “significant” correlations between variables that have nothing to do with each other. (This ties directly to the <a href="multiple-testing.html">Multiple Testing</a> page.)</p>
<p><strong>Trending variables are the worst offenders.</strong> If two time series both trend upward over time — say, US GDP and the number of cat videos on YouTube — they’ll be highly correlated even though neither causes the other. Mathematically, if <span class="math inline">\(X_t = a + bt + \varepsilon_t\)</span> and <span class="math inline">\(Y_t = c + dt + \eta_t\)</span> where <span class="math inline">\(\varepsilon\)</span> and <span class="math inline">\(\eta\)</span> are completely independent, the sample correlation between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> will be close to 1 because both share the time trend <span class="math inline">\(t\)</span>. The correlation is real in the data but meaningless — it’s driven by the common trend, not by any relationship between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>.</p>
<p><strong>The fix:</strong> large samples (reduces <span class="math inline">\(\text{Var}(r)\)</span>), pre-registration (decide what to test before looking at data), multiple testing corrections (Bonferroni, BH), and skepticism about correlations found by searching through many variables.</p>
</section>
<section id="collider-bias-the-trickiest-one" class="level3">
<h3 class="anchored" data-anchor-id="collider-bias-the-trickiest-one">Collider bias: the trickiest one</h3>
<p>The first four reasons are intuitive. The fifth — <strong>collider bias</strong> — is subtle and catches even experienced researchers.</p>
<p>Start with the name. In causal diagrams, arrows show what causes what. A <strong>collider</strong> is a variable where two arrows point <em>into</em> it:</p>
<p><span class="math display">\[X \to C \leftarrow Y\]</span></p>
<p>The variable <span class="math inline">\(C\)</span> “collides” — it’s caused by both <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>. On its own, that’s fine. <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> can be completely independent. The problem starts when you <strong>condition on the collider</strong> — by restricting your sample to specific values of <span class="math inline">\(C\)</span>, or by controlling for <span class="math inline">\(C\)</span> in a regression. That act of conditioning opens a fake pathway between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> that doesn’t exist in the real world.</p>
<p><strong>Why does conditioning on a collider create a fake association?</strong> Think of it as an information leak. If you know someone is in a specific group (defined by <span class="math inline">\(C\)</span>), then learning about <span class="math inline">\(X\)</span> tells you something about <span class="math inline">\(Y\)</span> — not because they’re related, but because both contributed to getting into that group. Knowing one cause of <span class="math inline">\(C\)</span> changes what you infer about the other cause.</p>
<p><strong>The hospital example, step by step.</strong></p>
<ol type="1">
<li>Disease A and disease B are <strong>completely unrelated</strong> in the general population. Knowing someone has A tells you nothing about whether they have B.</li>
<li>Both diseases can put you in the hospital. “Hospitalization” is a collider: A → Hospital ← B.</li>
<li>Now you study <strong>only hospitalized patients</strong>. You’ve conditioned on the collider.</li>
<li>Pick a hospitalized patient. You learn they <em>don’t</em> have disease A. But they’re in the hospital — so something put them there. That something is more likely to be disease B.</li>
<li>Result: among hospitalized patients, A and B look <strong>negatively correlated</strong>. Not because one prevents the other, but because you restricted your sample to people who have <em>at least one</em> of them.</li>
</ol>
<p>In the general population: no correlation. In the hospital: negative correlation. The correlation is entirely an artifact of how you selected your sample.</p>
<p><strong>The talent-attractiveness tradeoff.</strong></p>
<ol type="1">
<li>In the general population, acting talent and physical attractiveness are <strong>unrelated</strong>. Plenty of beautiful untalented people, plenty of talented plain-looking people.</li>
<li>Hollywood selects actors who are talented OR attractive OR both. “Getting cast” is a collider: Talent → Cast ← Attractiveness.</li>
<li>Among <em>successful actors</em> (conditioned on being cast), you notice: the beautiful ones seem less talented, and the talented ones seem less attractive.</li>
<li>Why? If an actor isn’t particularly talented, they probably got cast because they’re attractive (and vice versa). Knowing one cause tells you about the other — but only within the selected group.</li>
<li>You conclude “there’s a tradeoff between talent and looks.” There isn’t. You’re seeing collider bias.</li>
</ol>
<p><strong>How it shows up in research.</strong> Collider bias often sneaks in through:</p>
<ul>
<li><strong>Sample selection:</strong> studying only college graduates, only employed people, only published studies, only survivors</li>
<li><strong>Controlling for post-treatment variables:</strong> if you run a regression of X on Y “controlling for” a variable that X and Y both cause, you’ve conditioned on a collider</li>
<li><strong>Attrition:</strong> if people drop out of your study for reasons related to both treatment and outcome, the remaining sample is conditioned on a collider</li>
</ul>
<p><strong>The fix:</strong> think carefully about the causal structure <em>before</em> you run your regression. Draw the diagram. If a variable is caused by your treatment and your outcome, <strong>don’t control for it and don’t select on it</strong>. Condition only on variables that are causes (confounders), never on variables that are consequences (colliders).</p>
<hr>
</section>
</section>
<section id="when-does-correlation-become-causation" class="level2">
<h2 class="anchored" data-anchor-id="when-does-correlation-become-causation">When does correlation become causation?</h2>
<p><strong>Correlation becomes causal when you can rule out reasons 2–5.</strong> That’s what the entire field of causal inference is about.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th>Threat</th>
<th>What it means</th>
<th>How to address it</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Confounding</strong></td>
<td>A third variable drives both X and Y</td>
<td>Randomize, or control for all confounders (hard)</td>
</tr>
<tr class="even">
<td><strong>Reverse causality</strong></td>
<td>Y causes X, not the other way around</td>
<td>Randomize, use timing/lags, or find an instrument</td>
</tr>
<tr class="odd">
<td><strong>Selection / collider bias</strong></td>
<td>Your sample is selected in a way that creates a spurious relationship</td>
<td>Think carefully about your sample; don’t condition on post-treatment variables</td>
</tr>
<tr class="even">
<td><strong>Coincidence</strong></td>
<td>Small samples, multiple testing</td>
<td>Large samples, pre-registration, corrections</td>
</tr>
</tbody>
</table>
<p><strong>Randomization solves all of them at once</strong> — that’s why RCTs are the gold standard. But randomization isn’t always possible (you can’t randomly assign smoking, education, or recessions). That’s where the causal inference toolkit comes in:</p>
<ul>
<li><strong>Instrumental variables (IV):</strong> find something that affects X but has no other path to Y</li>
<li><strong>Difference-in-differences (DiD):</strong> compare before/after changes between treated and untreated groups</li>
<li><strong>Regression discontinuity (RDD):</strong> exploit a cutoff that creates near-random assignment</li>
<li><strong>Matching / propensity scores:</strong> create comparable treated and control groups from observational data</li>
</ul>
<p>Each method makes different assumptions to rule out the threats above. <strong>None is universally valid</strong> — the right method depends on your setting.</p>
<p>These methods are covered in depth in the <a href="../causal-inference/index.html">Causal Inference course</a>.</p>
<hr>
</section>
<section id="did-you-know" class="level2">
<h2 class="anchored" data-anchor-id="did-you-know">Did you know?</h2>
<ul>
<li><p>The phrase <strong>“correlation does not imply causation”</strong> is one of the most cited principles in statistics, yet researchers violate it constantly. A 2019 study found that <strong>over 30% of observational studies in top medical journals</strong> used causal language (like “X reduces Y”) without any causal identification strategy.</p></li>
<li><p><strong>Ronald Fisher</strong>, the father of modern statistics, spent decades arguing that the correlation between smoking and lung cancer was not causal — it could be confounding by a genetic factor that causes both the desire to smoke and susceptibility to cancer. He was wrong, but his <em>argument</em> was statistically valid. It took decades of converging evidence from multiple study designs to establish causality.</p></li>
<li><p>The <strong>2021 Nobel Prize in Economics</strong> went to <strong>David Card</strong>, <strong>Joshua Angrist</strong>, and <strong>Guido Imbens</strong> for developing methods to establish causal relationships from observational data — essentially for building the toolkit described above. Their key insight: you don’t need a perfect experiment; you need a credible <strong>natural experiment</strong> where something approximates random assignment.</p></li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>© 2026 <a href="https://nencydhameja.com">Nency Dhameja</a> | <a href="../index.html">All Notes</a><br>Built with AI assistance · Inspired by my advisor, <a href="https://sites.google.com/site/slichterdavid/home">David Slichter</a></p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>